function createEditor(e){var o=null,r=function(){var o=document.getElementById("splash");if(null!=o)try{mxEvent.release(o),mxEffects.fadeOut(o,100,!0)}catch(r){o.parentNode.removeChild(o)}};try{if(!mxClient.isBrowserSupported())mxUtils.error("Browser is not supported!",200,!1);else{mxObjectCodec.allowEval=!0;var g=mxUtils.load(e).getDocumentElement();o=new mxEditor(g),mxObjectCodec.allowEval=!1,o.graph.createPanningManager=function(){var e=new mxPanningManager(this);return e.border=30,e},o.graph.allowAutoPanning=!0,o.graph.timerAutoScroll=!0;var i=document.title,a=function(e){document.title=i+" - "+e.getTitle()};o.addListener(mxEvent.OPEN,a),o.addListener(mxEvent.ROOT,a),a(o),r()}}catch(o){throw r(),mxUtils.alert("Cannot start application: "+o.message),o}return o}function onInit(e){function o(){for(var o=e.graph.getDefaultParent(),i=e.graph.getChildCells(o),l=0;l<i.length;l++){var m=e.graph.getChildEdges(i[l])[0],d=i[l],y=e.graph.getChildCells(i[l])[0],s=e.graph.getChildCells(i[l])[1],h=y.geometry,x=s.geometry,u=n(e.graph.getChildCells(i[l]),"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0");if(c.checked)var P=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var P=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");P.cursor="hand",e.graph.addCellOverlay(m,P);var C=g();P.addListener(mxEvent.CLICK,function(o,r){e.graph.clearSelection();var g=prompt("New Element Name","Enter here"),i=0;if(null!=g){var l=r.getProperty("cell"),m=l.getParent(),d=e.graph.getChildCells(m)[0],y=e.graph.getChildCells(m)[1],s=d.geometry,h=y.geometry,c=n(e.graph.getChildCells(m),"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0");for(f=0;f<C.length;f++)0==g.localeCompare(C[f])&&i++;if(0<i)var p=e.templates.rectangle;else var p=e.templates.rounded;var x=e.graph.model.cloneCell(p);x.setAttribute("label",g);var u=x.getGeometry();u.width=1==g.length?Math.round(a(g,"11px arial"))+10:Math.round(a(g,"11px arial"))+30,e.graph.model.setGeometry(x,u);var P=e.graph.model.getChildren(m),b=0;for(f=0;f<P.length;f++){var w=P[f].getValue();if("Rect"==w.tagName||"Roundrect"==w.tagName){var v=P[f].getGeometry();if(v.x>b&&v.y==h.y-6){b=v.x+v.width}}}for(f=0;f<P.length;f++){var w=P[f].getValue();if("Connector"==w.tagName){for(var E=e.graph.getChildEdges(P[f]),G=0;G<E.length;G++)E[G].geometry.sourcePoint.x>b&&(b=E[G].geometry.sourcePoint.x),E[G].geometry.targetPoint.x>b&&(b=E[G].geometry.targetPoint.x);break}}var N=e.graph.model.add(m,x),O=e.graph.getCellGeometry(N).clone();O.height=20,O.y=h.y-6,O.x="undefined"==typeof v?d.geometry.x+d.geometry.width+40:b+40,e.graph.model.setGeometry(N,O);var T=0,B=e.graph.model.getChildren(m);for(f=0;f<B.length;f++){var A=P[f].getGeometry();A.x+A.width>T&&(T=A.x+A.width)}var I=m.geometry;I.width=1.15*T,h.x=I.width-10,e.graph.model.setGeometry(y,h),e.graph.model.setGeometry(m,I);var R=e.graph.getCellGeometry(c).clone();R.x=Math.round(I.width/2)-R.width/2,e.graph.model.setGeometry(c,R),e.graph.refresh()}}),P.getBounds=function(e){var o=mxCellOverlay.prototype.getBounds.apply(this,arguments);if(e.view.graph.getModel().isEdge(e.cell)){var r=e.view.getPoint(e,{x:1,y:0,relative:!0});o.x=r.x-o.width/2,o.y=r.y-o.height/2}return o},e.graph.refresh();for(var b=e.graph.getChildEdges(m),j=0;j<b.length;j++)if(b[j].geometry.sourcePoint.y==b[j].geometry.targetPoint.y){var w=b[j],v=b[j-1],E=b[j-2],G={x:Math.max(E.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:Math.max(E.geometry.targetPoint.y,E.geometry.sourcePoint.y)},N={x:Math.min(E.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:Math.min(E.geometry.targetPoint.y,E.geometry.sourcePoint.y)},O={x:Math.max(v.geometry.targetPoint.x,v.geometry.sourcePoint.x),y:Math.max(v.geometry.targetPoint.y,v.geometry.sourcePoint.y)},T={x:Math.min(v.geometry.targetPoint.x,v.geometry.sourcePoint.x),y:Math.min(v.geometry.targetPoint.y,v.geometry.sourcePoint.y)},B={x:Math.max(w.geometry.targetPoint.x,w.geometry.sourcePoint.x),y:w.geometry.targetPoint.y},A={x:Math.min(w.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:w.geometry.targetPoint.y};if(c.checked)var I=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var I=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");I.cursor="hand",I.offset.x=(O.x-G.x-60)/2,e.graph.addCellOverlay(w,I),I.addListener(mxEvent.CLICK,function(o,r){e.graph.clearSelection();var i=prompt("New Element Name","Enter here"),n=0;if(C=g(),null!=i){var l=r.getProperty("cell");console.log(l);var m=l.getParent(),d=m.getParent();console.log(d);var y=e.graph.getChildCells(d)[0],s=e.graph.getChildCells(d)[1],h=y.geometry,c=s.geometry,p=l.geometry,x={x:Math.min(l.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:l.geometry.targetPoint.y};for(f=0;f<C.length;f++)0==i.localeCompare(C[f])&&n++;if(0<n)var u=e.templates.rectangle;else var u=e.templates.rounded;var P=e.graph.model.cloneCell(u);P.setAttribute("label",i);var b=P.getGeometry();b.width=Math.round(a(i,"11px arial"))+30,e.graph.model.setGeometry(P,b);var w=[],v=e.graph.model.getChildren(d),N=G.x;for(f=0;f<v.length;f++){var O=v[f].getValue();if("Rect"==O.tagName||"Roundrect"==O.tagName){var A=v[f].getGeometry();if(A.x>=G.x&&A.y==x.y-10&&A.x<=T.x){if(A.x+A.width>=N){N=A.x+A.width;var I=A}w.push(v[f])}}}var R=e.graph.model.add(d,P),V=e.graph.getCellGeometry(R).clone();if(V.height=20,V.y=x.y-10,"undefined"!=typeof I){var k=40;for(f=0;f<w.length;f++)k+=w[f].getGeometry().width+40;if(k+=V.width,k>Math.abs(B.x-x.x)){for(f=0;f<v.length;f++){var O=v[f].getValue();if(("Rect"==O.tagName||"Roundrect"==O.tagName)&&v[f].geometry.x>=B.x){var L=v[f].geometry;L.x+=V.width+40,e.graph.model.setGeometry(v[f],L)}}for(f=0;f<v.length;f++){var S=v[f].getStyle();if("ellipse"==S&&v[f].geometry.x>B.x){var L=v[f].geometry;L.x+=V.width+40,e.graph.model.setGeometry(v[f],L)}var M=B.x,O=v[f].getValue();if("Connector"==O.tagName)for(var _=e.graph.getChildEdges(v[f]),D=0;D<_.length;D++){if(_[D].geometry.sourcePoint.x>=M){var X=_[D].geometry;if(X.sourcePoint.x+=V.width+40,e.graph.model.setGeometry(_[D],X),null!=e.graph.getCellOverlays(_[D])){var H=e.graph.getCellOverlays(_[D])[0];H.image=new mxImage("images/add.png",28,28),H.offset.x=Math.abs((X.targetPoint.x-X.sourcePoint.x)/2)}}if(_[D].geometry.targetPoint.x>=M){var X=_[D].geometry;if(X.targetPoint.x+=V.width+40,e.graph.model.setGeometry(_[D],X),null!=e.graph.getCellOverlays(_[D])){var H=e.graph.getCellOverlays(_[D])[0];H.image=new mxImage("images/add.png",28,28),H.offset.x=Math.abs((X.targetPoint.x-X.sourcePoint.x)/2)}}if(null!=_[D].geometry.points&&_[D].geometry.points[0].x>=M){var X=_[D].geometry;X.points[0].x+=V.width+40,e.graph.model.setGeometry(_[D],X)}}}V.x=N+40}else V.x=N+40}else{if(V.width+20>Math.abs(p.targetPoint.x-p.sourcePoint.x)){var v=e.graph.model.getChildren(d);for(f=0;f<v.length;f++){var O=v[f].getValue();if(("Rect"==O.tagName||"Roundrect"==O.tagName)&&v[f].geometry.x>=B.x){var L=v[f].geometry;L.x+=V.width+10,e.graph.model.setGeometry(v[f],L)}}for(f=0;f<v.length;f++){var S=v[f].getStyle();if("ellipse"==S&&v[f].geometry.x>B.x){var L=v[f].geometry;L.x+=V.width+10,e.graph.model.setGeometry(v[f],L)}var M=B.x,O=v[f].getValue();if("Connector"==O.tagName)for(var _=e.graph.getChildEdges(v[f]),D=0;D<_.length;D++){if(_[D].geometry.sourcePoint.x>=M){var X=_[D].geometry;if(X.sourcePoint.x+=V.width+10,e.graph.model.setGeometry(_[D],X),null!=e.graph.getCellOverlays(_[D])){var H=e.graph.getCellOverlays(_[D])[0];H.image=new mxImage("images/add.png",28,28),H.offset.x=Math.abs((X.targetPoint.x-X.sourcePoint.x)/2)}}if(_[D].geometry.targetPoint.x>=M){var X=_[D].geometry;if(X.targetPoint.x+=V.width+10,e.graph.model.setGeometry(_[D],X),null!=e.graph.getCellOverlays(_[D])){var H=e.graph.getCellOverlays(_[D])[0];H.image=new mxImage("images/add.png",28,28),H.offset.x=Math.abs((X.targetPoint.x-X.sourcePoint.x)/2)}}if(null!=_[D].geometry.points&&_[D].geometry.points[0].x>=M){var X=_[D].geometry;X.points[0].x+=V.width+10,e.graph.model.setGeometry(_[D],X)}}}}V.x=p.targetPoint.x>p.sourcePoint.x?p.sourcePoint.x+10:p.targetPoint.x+10}e.graph.model.setGeometry(R,V);var W=0,v=e.graph.model.getChildren(d);for(f=0;f<v.length;f++){var U=v[f].getGeometry();U.x>W&&(W=U.x+U.width)}var K=d.getGeometry();for(K.width=W,e.graph.model.setGeometry(d,K),f=0;f<v.length;f++){var S=v[f].getStyle();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==S){var F=v[f].getGeometry();F.x=F.x=Math.round(K.width/2)-F.width/2,e.graph.model.setGeometry(v[f],F);break}}e.graph.refresh()}})}}var R=[],V=null;e.graph.addMouseListener({currentState:null,mouseDown:function(o,l){if(null!=this.currentState&&this.dragLeave(l.getEvent(),this.currentState),e.graph.model.isVertex(l.getCell())){var m=l.getCell(),d=m.geometry,y=m.getParent(),s=y.geometry;if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==m.style&&m.parent==y){console.log(y);for(var h=e.graph.getChildCells(y),x=e.graph.getChildCells(y)[0],P=e.graph.getChildCells(y)[1],b=x.geometry,f=P.geometry,w=[],v=0;v<h.length;v++)if("Rect"==h[v].value.tagName||"Roundrect"==h[v].value.tagName){var E=!1,G=!1,N=h[v].geometry.x,O=e.graph.model.getChildren(y);for(z=0;z<O.length;z++){var T=O[z].getValue();if("Connector"==T.tagName){var B=e.graph.getChildEdges(O[z]);if(null!=B)for(var A=0;A<B.length;A++)if(N+h[v].geometry.width<Math.max(B[A].geometry.targetPoint.x,B[A].geometry.sourcePoint.x)&&N+h[v].geometry.width>Math.min(B[A].geometry.targetPoint.x,B[A].geometry.sourcePoint.x)&&B[A].geometry.targetPoint.y==B[A].geometry.sourcePoint.y&&h[v].geometry.y<B[A].geometry.sourcePoint.y-10&&(G=!0),N<Math.max(B[A].geometry.targetPoint.x,B[A].geometry.sourcePoint.x)&&N>Math.min(B[A].geometry.targetPoint.x,B[A].geometry.sourcePoint.x)&&B[A].geometry.targetPoint.y==B[A].geometry.sourcePoint.y&&h[v].geometry.y<B[A].geometry.sourcePoint.y-10){E=!0;break}}}var I=0;if(h[v].geometry.y>O[1].geometry.y-6&&!1==E){var B=e.graph.getChildEdges(O[2]);if(null!=B)for(var A=0;A<B.length;A++){var k=Math.min(B[A].geometry.targetPoint.x,B[A].geometry.sourcePoint.x),L=Math.max(B[A].geometry.targetPoint.x,B[A].geometry.sourcePoint.x);if(B[A].geometry.targetPoint.y==B[A].geometry.sourcePoint.y&&B[A].geometry.sourcePoint.y-10==h[v].geometry.y&&h[v].geometry.x>k&&h[v].geometry.x+h[v].geometry.width<L){for(var S=0;S<h.length;S++)if(B[A].geometry.sourcePoint.y-10==h[S].geometry.y&&h[S].geometry.x>k&&h[S].geometry.x+h[S].geometry.width<L&&h[v].geometry.x<h[S].geometry.x){I++;break}break}}}if(0==I&&!G&&h[v].geometry.y>O[1].geometry.y-6){var M=e.graph.insertVertex(y,null,"",h[v].geometry.x+h[v].geometry.width+10,h[v].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");w.unshift(M)}if(!E){var M=e.graph.insertVertex(y,null,"",h[v].geometry.x-30,h[v].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");w.unshift(M),E=!1}}var M=e.graph.insertVertex(y,null,"",P.geometry.x-20,P.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");w.unshift(M);var M=e.graph.insertVertex(y,null,"",x.geometry.x+x.geometry.width+10,x.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");w.unshift(M);var _=document.createElement("div");_.innerHTML="<table height=100%> <tr> <td> <span id='vertTip'> Select the first (start) point </span> </td></tr><tr><td> <button style=\"float:bottom\" id='closeBtn' style='align:right'>Cancel</button> </td></tr></table> ",V=new mxWindow("Tip",_,l.getX(),l.getY(),250,void 0,!1,!0),V.setLocation=function(e,o){e=l.getX(),o=l.getY(),mxWindow.prototype.setLocation.apply(this,arguments)},document.getElementById("closeBtn").onclick=function(){for(var o=0;o<w.length;o++)e.graph.model.remove(w[o]);V.destroy(),c.checked=!0,p(e),R.length=0},c.checked=!1,p(e),V.setVisible(!0)}if("image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==m.style&&m.parent==y){4>R.length&&(R.push(d.x+d.width/2),R.push(d.y+10));var h=e.graph.getChildCells(y);if(2==R.length){for(var v=0;v<h.length;v++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==h[v].style&&d.y!=h[v].geometry.y&&e.graph.model.remove(h[v]);document.getElementById("vertTip").innerHTML="Select the second (end) point"}if(4==R.length){for(var v=0;v<h.length;v++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==h[v].style&&e.graph.model.remove(h[v]);var x=e.graph.getChildCells(y)[0],P=e.graph.getChildCells(y)[1],D=e.graph.getChildCells(y)[2],b=x.geometry,f=P.geometry,X=x.geometry.y+x.geometry.height/2+30,O=e.graph.model.getChildren(y);for(v=0;v<O.length;v++){var T=O[v].getValue();if("Connector"==T.tagName){var B=e.graph.getChildEdges(O[v]);if(null!=B)for(var A=0;A<B.length;A++)B[A].geometry.sourcePoint.y==B[A].geometry.targetPoint.y&&B[A].geometry.targetPoint.y>=X&&(B[A].geometry.sourcePoint.x>=R[0]&&B[A].geometry.targetPoint.x<=R[2]?X=B[A].geometry.targetPoint.y:B[A].geometry.targetPoint.x>=R[0]&&B[A].geometry.sourcePoint.x<=R[2]&&(X=B[A].geometry.targetPoint.y));break}}var H=X+30,W=0;if(R[0]==R[2]&&R[1]==R[3]&&(W=1),R[0]>R[2]){W=2;var U=R[0];R[0]=R[2],R[2]=U}var K=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==W?(K.geometry.setTerminalPoint(new mxPoint(R[0],R[1]),!0),K.geometry.setTerminalPoint(new mxPoint(R[0]+30,H),!1)):1==W?(K.geometry.setTerminalPoint(new mxPoint(R[0],R[1]),!0),K.geometry.setTerminalPoint(new mxPoint(R[0]+30,H),!1)):2==W&&(K.geometry.setTerminalPoint(new mxPoint(R[0]+15,R[1]),!1),K.geometry.points=[new mxPoint(R[0],R[1]+5)],K.geometry.setTerminalPoint(new mxPoint(R[0]+30,H),!0)),K.edge=!0,K=e.graph.addCell(K,D),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[K]));var F=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==W?(F.geometry.setTerminalPoint(new mxPoint(R[2]-30,H),!0),F.geometry.setTerminalPoint(new mxPoint(R[2],R[3]),!1)):1==W?(F.geometry.setTerminalPoint(new mxPoint(R[2]-30,H),!1),F.geometry.setTerminalPoint(new mxPoint(R[2],R[3]),!0)):2==W&&(F.geometry.setTerminalPoint(new mxPoint(R[2]-30,H),!1),F.geometry.points=[new mxPoint(R[2],R[3]+5)],F.geometry.setTerminalPoint(new mxPoint(R[2]-15,R[3]),!0)),F.edge=!0,F=e.graph.addCell(F,D),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[F]));var Y=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==W?(Y.geometry.setTerminalPoint(new mxPoint(R[0]+30,H),!0),Y.geometry.setTerminalPoint(new mxPoint(R[2]-30,H),!1)):1==W?(Y.geometry.setTerminalPoint(new mxPoint(R[0]+30,H),!0),Y.geometry.setTerminalPoint(new mxPoint(R[2]-30,H),!1)):2==W&&(Y.geometry.setTerminalPoint(new mxPoint(R[0]+30,H),!1),Y.geometry.setTerminalPoint(new mxPoint(R[2]-30,H),!0)),Y.edge=!0,Y=e.graph.addCell(Y,D),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[Y])),u=n(y.children,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0");var Z=u.geometry;Z.y=H+50,e.graph.model.setGeometry(u,Z);var s=e.graph.getCellGeometry(y).clone();s.height=Z.y+Z.height,e.graph.model.setGeometry(y,s);var q=Y.geometry,J=K.geometry,Q=F.geometry;if(0==W)var $={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},ee={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},te={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},oe={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},re={x:q.sourcePoint.x,y:q.sourcePoint.y},ge={x:q.targetPoint.x,y:q.targetPoint.y};else if(1==W)var $={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},ee={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},te={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},oe={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},re={x:Y.geometry.sourcePoint.x,y:Y.geometry.sourcePoint.y},ge={x:Y.geometry.targetPoint.x,y:Y.geometry.targetPoint.y};else if(2==W)var $={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},ee={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},te={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},oe={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},re={x:Y.geometry.targetPoint.x,y:Y.geometry.targetPoint.y},ge={x:Y.geometry.sourcePoint.x,y:Y.geometry.sourcePoint.y};if(c.checked)var ie=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var ie=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");ie.cursor="hand",0==W?ie.offset.x=(oe.x-ee.x-60)/2:2==W&&(ie.offset.x=(oe.x-ee.x-60)/2),e.graph.addCellOverlay(Y,ie),ie.addListener(mxEvent.CLICK,function(){if(0==W)var o={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},r={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},i={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},n={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},l={x:Y.geometry.sourcePoint.x,y:Y.geometry.sourcePoint.y},m={x:Y.geometry.targetPoint.x,y:Y.geometry.targetPoint.y};else if(2==W)var o={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},r={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},i={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},n={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},l={x:Y.geometry.targetPoint.x,y:Y.geometry.targetPoint.y},m={x:Y.geometry.sourcePoint.x,y:Y.geometry.sourcePoint.y};e.graph.clearSelection();var d=prompt("New Element Name","Enter here"),s=0;if(C=g(),null!=d){for(v=0;v<C.length;v++)0==d.localeCompare(C[v])&&s++;if(0<s)var h=e.templates.rectangle;else var h=e.templates.rounded;var c=e.graph.model.cloneCell(h);c.setAttribute("label",d);var p=c.getGeometry();p.width=Math.round(a(d,"11px arial"))+30,e.graph.model.setGeometry(c,p);var x=[],u=e.graph.model.getChildren(y),P=r.x;for(v=0;v<u.length;v++){var b=u[v].getValue();if("Rect"==b.tagName||"Roundrect"==b.tagName){var f=u[v].getGeometry();if(f.x>=r.x&&f.y==l.y-10&&f.x<=i.x){if(f.x+f.width>=P){P=f.x+f.width;var w=f}x.push(u[v])}}}var E=e.graph.model.add(y,c),G=e.graph.getCellGeometry(E).clone();if(G.height=20,G.y=l.y-10,"undefined"!=typeof w){var N=40;for(v=0;v<x.length;v++)N+=x[v].getGeometry().width+40;if(N+=G.width,N>Math.abs(m.x-l.x)){for(v=0;v<u.length;v++){var b=u[v].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&u[v].geometry.x>=m.x){var O=u[v].geometry;O.x+=G.width+40,e.graph.model.setGeometry(u[v],O)}}for(v=0;v<u.length;v++){var T=u[v].getStyle();if("ellipse"==T&&u[v].geometry.x>m.x){var O=u[v].geometry;O.x+=G.width+40,e.graph.model.setGeometry(u[v],O)}var B=m.x,b=u[v].getValue();if("Connector"==b.tagName)for(var A=e.graph.getChildEdges(u[v]),I=0;I<A.length;I++){if(A[I].geometry.sourcePoint.x>=B){var R=A[I].geometry;if(R.sourcePoint.x+=G.width+40,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(A[I].geometry.targetPoint.x>=B){var R=A[I].geometry;if(R.targetPoint.x+=G.width+40,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(null!=A[I].geometry.points&&A[I].geometry.points[0].x>=B){var R=A[I].geometry;R.points[0].x+=G.width+40,e.graph.model.setGeometry(A[I],R)}}}G.x=P+40}else G.x=P+40}else{if(G.width+20>Math.abs(q.targetPoint.x-q.sourcePoint.x)){var u=e.graph.model.getChildren(y);for(v=0;v<u.length;v++){var b=u[v].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&u[v].geometry.x>=m.x){var O=u[v].geometry;O.x+=G.width+10,e.graph.model.setGeometry(u[v],O)}}for(v=0;v<u.length;v++){var T=u[v].getStyle();if("ellipse"==T&&u[v].geometry.x>m.x){var O=u[v].geometry;O.x+=G.width+10,e.graph.model.setGeometry(u[v],O)}var B=m.x,b=u[v].getValue();if("Connector"==b.tagName)for(var A=e.graph.getChildEdges(u[v]),I=0;I<A.length;I++){if(A[I].geometry.sourcePoint.x>=B){var R=A[I].geometry;if(R.sourcePoint.x+=G.width+10,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(A[I].geometry.targetPoint.x>=B){var R=A[I].geometry;if(R.targetPoint.x+=G.width+10,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(null!=A[I].geometry.points&&A[I].geometry.points[0].x>=B){var R=A[I].geometry;R.points[0].x+=G.width+10,e.graph.model.setGeometry(A[I],R)}}}}G.x=q.targetPoint.x>q.sourcePoint.x?q.sourcePoint.x+10:q.targetPoint.x+10}e.graph.model.setGeometry(E,G);var k=0,u=e.graph.model.getChildren(y);for(v=0;v<u.length;v++){var L=u[v].getGeometry();L.x>k&&(k=L.x+L.width)}var S=y.getGeometry();for(S.width=k,e.graph.model.setGeometry(y,S),v=0;v<u.length;v++){var T=u[v].getStyle();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==T){var M=u[v].getGeometry();M.x=M.x=Math.round(S.width/2)-M.width/2,e.graph.model.setGeometry(u[v],M);break}}e.graph.refresh()}}),R.length=0,V.destroy(),c.checked=!0,p(e),r()}}}},mouseMove:function(){},mouseUp:function(){},dragEnter:function(){},dragLeave:function(){}})}function r(){var o=e.graph.getDefaultParent(),r=e.graph.getChildCells(o);if(0<r.length){for(var g=0;g<r.length-1;g++){var a=r[g].geometry,n=r[g+1].geometry;a.y+a.height>n.y&&(n.y=a.y+a.height,e.graph.model.setGeometry(r[g+1],n))}e.graph.refresh()}}function g(){var o=[],r=e.graph.getDefaultParent(),g=e.graph.model.getChildCells(r);if(0<g.length)for(var g=e.graph.getChildCells(r),a=0;a<g.length;a++)o.push(g[a].getAttribute("label").slice(0,-1));return o}function a(e,o){var r=a.canvas||(a.canvas=document.createElement("canvas")),g=r.getContext("2d");g.font=o;var i=g.measureText(e);return i.width}function n(e,o){for(var r=null,g=0;g<e.length;g++)if(e[g].getStyle()==o){r=e[g];break}return r}mxGraphHandler.prototype.guidesEnabled=!0,mxGuide.prototype.isEnabledForEvent=function(e){return!mxEvent.isAltDown(e)},mxEdgeHandler.prototype.snapToTerminals=!0,mxConnectionHandler.prototype.connectImage=new mxImage("images/connector.gif",16,16),e.graph.setConnectable(!1),e.graph.connectionHandler.setCreateTarget(!0);var l=document.getElementById("graph"),m=document.getElementById("toolbar");l.style.width=.95*window.innerWidth-m.getBoundingClientRect().width,l.style.height=.95*window.innerHeight-document.getElementById("header").getBoundingClientRect().height-28-document.getElementById("mainActions").getBoundingClientRect().height-document.getElementById("zoomActions").getBoundingClientRect().height-document.getElementById("source").getBoundingClientRect().height;window.addEventListener("resize",function(){l.style.width=.95*window.innerWidth-m.getBoundingClientRect().width,l.style.height=.95*window.innerHeight-document.getElementById("header").getBoundingClientRect().height-document.getElementById("mainActions").getBoundingClientRect().height-document.getElementById("zoomActions").getBoundingClientRect().height}),mxEvent.addMouseWheelListener(function(o,r){mxEvent.isConsumed(o)||(r&&!1==document.getElementById("source").checked?e.execute("zoomIn"):!1==document.getElementById("source").checked&&e.execute("zoomOut"),mxEvent.consume(o))});var d=document.getElementById("xml"),y=e.graph.container,s=document.getElementById("source");s.checked=!1;var h=function(e){if(s.checked){y.style.display="none",d.style.display="inline";var o=new mxCodec,r=o.encode(e.graph.getModel());d.value=mxUtils.getPrettyXml(r),d.originalValue=d.value,d.focus()}else{if(y.style.display="",d.value!=d.originalValue){var g=mxUtils.parseXml(d.value),i=new mxCodec(g);i.decode(g.documentElement,e.graph.getModel())}d.originalValue=null,mxClient.IS_IE&&mxUtils.clearSelection(),d.style.display="none",e.execute("actualSize"),e.graph.container.focus()}};e.addAction("switchView",h),mxEvent.addListener(s,"click",function(){e.execute("switchView")});var c=document.getElementById("overlayToggle");c.checked=!0;var p=function(e){if(c.checked){var o=e.graph.getDefaultParent(),r=e.graph.getChildCells(o);if(0<r.length)for(var g,a=0;a<r.length;a++){g=e.graph.getChildEdges(r[a]);for(var n=0;n<g.length;n++){if(null!=e.graph.getCellOverlays(g[n])){var l=e.graph.getCellOverlays(g[n])[0];l.image=new mxImage("images/add.png",28,28)}var m=g[n].getValue();if("Connector"==m.tagName)for(var d=e.graph.getChildEdges(g[n]),y=0;y<d.length;y++)if(null!=e.graph.getCellOverlays(d[y])){var l=e.graph.getCellOverlays(d[y])[0];l.image=new mxImage("images/add.png",28,28)}}for(var s,g=r[a].children,n=0;n<g.length;n++)s=g[n].style,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==s&&(g[n].visible=!0)}e.graph.refresh()}else{var o=e.graph.getDefaultParent(),h=e.graph.model.getChildCount(o);if(0<h)for(var g,r=e.graph.getChildCells(o),a=0;a<h;a++){g=e.graph.getChildEdges(r[a]);for(var n=0;n<g.length;n++){if(null!=e.graph.getCellOverlays(g[n])){var l=e.graph.getCellOverlays(g[n])[0];l.image=new mxImage("images/add.png",0,0)}var m=g[n].getValue();if("Connector"==m.tagName)for(var d=e.graph.getChildEdges(g[n]),y=0;y<d.length;y++)if(null!=e.graph.getCellOverlays(d[y])){var l=e.graph.getCellOverlays(d[y])[0];l.image=new mxImage("images/add.png",0,0)}}for(var s,g=r[a].children,n=0;n<g.length;n++)s=g[n].style,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==s&&(g[n].visible=!1)}e.graph.refresh()}};e.addAction("toggleOverlay",p),mxEvent.addListener(c,"click",function(){e.execute("toggleOverlay")});e.addAction("popupOverlayToggle",function(){c.checked=!c.checked,e.execute("toggleOverlay")});var x=document.getElementById("mainActions"),u=["new","clearCurrent","open","savelocal","save","exportWindow","openHelp","cut","copy","paste","delete","undo","redo","print"];null!=localStorage.getItem("state")&&u.splice(3,0,"openlocal");var P=null,C=function(){P&&P.destroy();var o=Math.floor(250/7),r=document.createElement("div");r.innerHTML=`<table id='exportDlgTable' width=90% align="center">
                  <tr>
                    <td style="padding-top:12px;padding-bottom:12px">
                      File Name
                    </td><td style="padding-top:12px;padding-bottom:12px">
                      <input style="display:table-cell;width:100%;" id='fileName'></input>
                    </td>
                  </tr><tr>
                    <td style="padding-top:12px;padding-bottom:12px">
                      File Format
                    </td><td style="padding-top:12px;padding-bottom:12px">
                      <select id='fileFormat' style="display:table-cell;width:100%;">
                      <option value="png">PNG</option>
                      <option value="jpeg">JPEG</option>
                      <option value="bmp">BMP</option>
                      <option value="svg">SVG</option>
                      </select>
                    </td>
                  </tr><tr>
                    <td style="padding-top:12px;padding-bottom:12px"></td><td style="padding-top:12px;padding-bottom:12px">
                      <button style='float:right;margin-left:12px;height:35px;width:60px' id='exportcBtn'>Cancel</button>
                      <button style='float:right;height:35px;width:60px;background:#4b8cf7;color:#ffffff;border-color:#3079ed;' id='exportBtn'>Export</button>
                    </td>
                  </tr>
                </table>`;var g=document.getElementById("exportWindow").getBoundingClientRect().left,i=document.getElementById("exportWindow").getBoundingClientRect().bottom;P=new mxWindow("Export Dialog",r,g,i,300,void 0,!0,!0,void 0),P.setClosable(!0),P.setMinimizable(!1),P.setVisible(!0),document.getElementById("exportWindow").disabled=!0;var a=document.getElementById("exportcBtn");a.onclick=function(){P.destroy(),document.getElementById("exportWindow").disabled=!1};var n=document.getElementById("exportBtn");n.onclick=function(){e.graph.clearSelection();var o=document.getElementById("fileFormat").value,r=document.getElementById("fileName").value;if(255>r.length&&0<r.length){console.log("filename got"),c.checked=!1,p(e);var g=e.graph,a=g.view.scale,n=g.getGraphBounds(),l=mxUtils.show(e.graph,"new",0,0,n.width,n.height),m=new XMLSerializer().serializeToString(l),d=m.substring(m.indexOf("<svg"),m.indexOf("</svg>")+6);if(document.getElementById("exportWindow").disabled=!1,"svg"==o){var y=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(y),h=document.createElement("a");h.href=s,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),c.checked=!0,p(e),P.hide()}else if("png"==o){var x=document.createElement("canvas");x.width=n.width,x.height=n.height,console.log(x),canvg(x,d,{userCORS:!0,ignoreDimensions:!0});for(var u=x.toDataURL("image/png"),C=atob(u.substring(22)),b=new Uint8Array(C.length),j=0,f=C.length;j<f;++j)b[j]=C.charCodeAt(j);var w=new Blob([b.buffer],{type:"image/png"}),v=URL.createObjectURL(w),h=document.createElement("a");h.href=v,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),c.checked=!0,p(e),P.hide()}else{var x=document.createElement("canvas");x.width=n.width,x.height=n.height,x.style.width=n.width,x.style.height=n.height,x.style.backgroundColor="rgba(255, 255, 255, 1)";var E=x.getContext("2d");if(E.fillStyle="#ffffff",E.fillRect(0,0,x.width,x.height),x.style.opacity="1","jpeg"==o)var G=d.indexOf(">"),d=d.slice(0,G+1)+`<rect width="100%" height="100%" fill="white"/>`+d.slice(G+1);canvg(x,d,{userCORS:!0,ignoreDimensions:!0});for(var N="image/"+o,u=x.toDataURL(N),C=atob(u.substring(("data:"+N+";base64,").length)),b=new Uint8Array(C.length),j=0,f=C.length;j<f;++j)b[j]=C.charCodeAt(j);var w=new Blob([b.buffer],{type:N}),v=URL.createObjectURL(w),h=document.createElement("a");h.href=v,r=r+"."+o,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),c.checked=!0,p(e),P.hide()}}P.isVisible()||P.destroy()}};e.addAction("openlocal",function(){e.graph.getModel().clear();var r=localStorage.getItem("state"),g=mxUtils.parseXml(r),i=new mxCodec(g);i.decode(g.documentElement,e.graph.getModel()),o()}),e.addAction("savelocal",function(){var o=new mxCodec,r=o.encode(e.graph.getModel()),g=mxUtils.getXml(r);localStorage.setItem("state",g)}),e.addAction("new",function(){window.open(window.location.href,"_blank")}),e.addAction("open",function(){var r=document.getElementById("file-input");r.onchange=function(){var g=r.files[0];if(g){var i=new FileReader;i.onload=function(){e.graph.getModel().clear();var r=i.result;r=r.split("syntax").join("mxGraphModel");var g=mxUtils.parseXml(r),a=new mxCodec(g);a.decode(g.documentElement,e.graph.getModel()),o()},i.readAsText(g)}},r.click()}),e.addAction("save",function(){var o=prompt("XML File Name (without extension)","filename");if(null!=o&&255>o.length&&0<o.length&&(-1==o.indexOf(".xml")||o.indexOf(".xml")!=o.length-5)&&(o+=".xml"),o){var r=new mxCodec,g=r.encode(e.graph.getModel()),i=mxUtils.getXml(g),a=new Blob([i],{type:"text/xml;charset=utf-8"}),n=URL.createObjectURL(a),l=document.createElement("a");l.href=n,l.download=o,document.body.appendChild(l),l.click(),document.body.removeChild(l)}}),e.addAction("exportWindow",C),e.addAction("openHelp",function(){window.open("../../index.html?noskip=1","_blank")}),e.addAction("clearCurrent",function(){e.graph.getModel().clear()});for(var b,f=0;f<u.length;f++){b=document.createElement("button"),b.id=u[f],b.className="tb_buttons",mxUtils.write(b,mxResources.get(u[f]));var j=function(o){return function(){e.execute(o)}};mxEvent.addListener(b,"click",j(u[f])),"cut"==b.id&&(b.style="margin-left:12px"),x.appendChild(b)}var x=document.getElementById("zoomActions");mxUtils.write(x,"Zoom "),mxUtils.linkAction(x,"In",e,"zoomIn"),mxUtils.write(x,", "),mxUtils.linkAction(x,"Out",e,"zoomOut"),mxUtils.write(x,", "),mxUtils.linkAction(x,"Actual",e,"actualSize"),mxUtils.write(x,", "),mxUtils.linkAction(x,"Fit",e,"fit"),e.addAction("addNewContainer",function(e){var o=prompt("Non-Terminal Name","nonterminal");if(null!=o){var n=0;o+=":";var l=e.graph.getDefaultParent(),m=e.graph.model.getChildCount(l);if(0<m){var d=e.graph.getChildCells(l),s=0;for(n=0;n<d.length;n++)if("swimlane"==d[n].style){var h=d[n].getGeometry();h.y+h.height>=s&&(s=h.y+h.height)}var x=s}else var x=0;var u=m+1,P=e.templates.container,C=e.graph.model.cloneCell(P),b=C.getGeometry();b.y=x,b.height=100,e.graph.model.setGeometry(C,b),C.setAttribute("label",o);var f=e.graph.model.add(l,C,u);e.graph.scrollCellToVisible(f);var w=0,d=e.graph.getChildCells(l),v=g();for(n=0;n<d.length;n++)if("swimlane"==d[n].style){var E=e.graph.model.getChildCells(d[n]);for(z=0;z<E.length;z++){var G=E[z].getValue();if("Roundrect"==G.tagName){for(t=0;t<v.length;t++){var N=E[z].getAttribute("label");0==N.localeCompare(v[t])&&w++}0<w&&(e.graph.model.setStyle(E[z],"Rect"),w=0)}}}P=e.templates.shape;var C=e.graph.model.cloneCell(P);u++;var O=e.graph.model.add(f,C,u),C=e.graph.model.cloneCell(P);u++;var T=e.graph.model.add(f,C,u),B=e.graph.getCellGeometry(f).clone(),A=e.graph.getCellGeometry(O).clone(),I=e.graph.getCellGeometry(T).clone();A.y+=55,I.y+=55,I.x+=.9*B.width,e.graph.model.setGeometry(O,A),e.graph.model.setGeometry(T,I);var R=e.templates.connector,V=e.graph.model.cloneCell(R),k=e.graph.addEdge(V,f,O,T),L=e.graph.insertVertex(f,null,"",b.width/2-25,A.y+25,35,35,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0");L.visible=!!c.checked;var S=[],M=null;if(e.graph.addMouseListener({currentState:null,mouseDown:function(o,n){if(null!=this.currentState&&this.dragLeave(n.getEvent(),this.currentState),e.graph.model.isVertex(n.getCell())){var l=n.getCell(),m=e.graph.getCellGeometry(l).clone(),d=e.graph.getCellGeometry(f).clone();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==l.style&&l.parent==f){var y=e.graph.getChildCells(f),s=[];console.log(y);for(var h=0;h<y.length;h++)if("Rect"==y[h].value.tagName||"Roundrect"==y[h].value.tagName){var x=!1,P=!1,C=y[h].geometry.x,b=e.graph.model.getChildren(f);for(z=0;z<b.length;z++){var w=b[z].getValue();if("Connector"==w.tagName){var E=z,G=e.graph.getChildEdges(b[z]);if(null!=G)for(var N=0;N<G.length;N++)if(C+y[h].geometry.width<Math.max(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&C+y[h].geometry.width>Math.min(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&G[N].geometry.targetPoint.y==G[N].geometry.sourcePoint.y&&y[h].geometry.y<G[N].geometry.sourcePoint.y-10&&(P=!0),C<Math.max(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&C>Math.min(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&G[N].geometry.targetPoint.y==G[N].geometry.sourcePoint.y&&y[h].geometry.y<G[N].geometry.sourcePoint.y-10){x=!0;break}}}var B=0;if(y[h].geometry.y>b[1].geometry.y-6&&!1==x){var G=e.graph.getChildEdges(b[2]);if(null!=G)for(var N=0;N<G.length;N++){var A=Math.min(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x),I=Math.max(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x);if(G[N].geometry.targetPoint.y==G[N].geometry.sourcePoint.y&&G[N].geometry.sourcePoint.y-10==y[h].geometry.y&&y[h].geometry.x>A&&y[h].geometry.x+y[h].geometry.width<I){for(var R=0;R<y.length;R++)if(G[N].geometry.sourcePoint.y-10==y[R].geometry.y&&y[R].geometry.x>A&&y[R].geometry.x+y[R].geometry.width<I&&y[h].geometry.x<y[R].geometry.x){B++;break}break}}}if(0==B&&!P&&y[h].geometry.y>b[1].geometry.y-6){var V=e.graph.insertVertex(f,null,"",y[h].geometry.x+y[h].geometry.width+10,y[h].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V)}if(!x){var V=e.graph.insertVertex(f,null,"",y[h].geometry.x-30,y[h].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V),x=!1}}var V=e.graph.insertVertex(f,null,"",T.geometry.x-20,T.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V);var V=e.graph.insertVertex(f,null,"",O.geometry.x+O.geometry.width+10,O.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V);var _=document.createElement("div");_.innerHTML="<table height=100%> <tr> <td> <span id='vertTip'> Select the first (start) point </span> </td></tr><tr><td id='ctrlCluster'> <button style=\"float:bottom\" id='closeBtn' style='align:right'>Cancel</button> </td></tr></table> ",M=new mxWindow("Tip",_,n.getX(),n.getY(),250,void 0,!1,!0),M.setLocation=function(e,o){e=n.getX(),o=n.getY(),mxWindow.prototype.setLocation.apply(this,arguments)},document.getElementById("closeBtn").onclick=function(){for(var o=0;o<s.length;o++)e.graph.model.remove(s[o]);M.destroy(),c.checked=!0,p(e),S.length=0},c.checked=!1,p(e),M.setVisible(!0)}if("image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==l.style&&l.parent==f){4>S.length&&(S.push(m.x+m.width/2),S.push(m.y+10));var y=e.graph.getChildCells(f);if(2==S.length){for(var h=0;h<y.length;h++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==y[h].style&&m.y!=y[h].geometry.y&&e.graph.model.remove(y[h]);document.getElementById("vertTip").innerHTML="Select the second (end) point"}if(4==S.length){for(var h=0;h<y.length;h++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==y[h].style&&e.graph.model.remove(y[h]);var D=O.geometry.y+O.geometry.height/2+30,b=e.graph.model.getChildren(f);for(h=0;h<b.length;h++){var w=b[h].getValue();if("Connector"==w.tagName){var G=e.graph.getChildEdges(b[h]);if(null!=G)for(var N=0;N<G.length;N++)G[N].geometry.sourcePoint.y==G[N].geometry.targetPoint.y&&G[N].geometry.targetPoint.y>=D&&(G[N].geometry.sourcePoint.x>=S[0]&&G[N].geometry.targetPoint.x<=S[2]?D=G[N].geometry.targetPoint.y:G[N].geometry.targetPoint.x>=S[0]&&G[N].geometry.sourcePoint.x<=S[2]&&(D=G[N].geometry.targetPoint.y))}}var X=D+30,H=0;if(S[0]==S[2]&&S[1]==S[3]&&(H=1),S[0]>S[2]){H=2;var W=S[0];S[0]=S[2],S[2]=W}var U=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==H?(U.geometry.setTerminalPoint(new mxPoint(S[0],S[1]),!0),U.geometry.setTerminalPoint(new mxPoint(S[0]+30,X),!1)):1==H?(U.geometry.setTerminalPoint(new mxPoint(S[0],S[1]),!0),U.geometry.setTerminalPoint(new mxPoint(S[0]+30,X),!1)):2==H&&(U.geometry.setTerminalPoint(new mxPoint(S[0]+15,S[1]),!1),U.geometry.points=[new mxPoint(S[0],S[1]+5)],U.geometry.setTerminalPoint(new mxPoint(S[0]+30,X),!0)),U.edge=!0,U=e.graph.addCell(U,k),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[U]));var K=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==H?(K.geometry.setTerminalPoint(new mxPoint(S[2]-30,X),!0),K.geometry.setTerminalPoint(new mxPoint(S[2],S[3]),!1)):1==H?(K.geometry.setTerminalPoint(new mxPoint(S[2]-30,X),!1),K.geometry.setTerminalPoint(new mxPoint(S[2],S[3]),!0)):2==H&&(K.geometry.setTerminalPoint(new mxPoint(S[2]-30,X),!1),K.geometry.points=[new mxPoint(S[2],S[3]+5)],K.geometry.setTerminalPoint(new mxPoint(S[2]-15,S[3]),!0)),K.edge=!0,K=e.graph.addCell(K,k),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[K]));var F=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==H?(F.geometry.setTerminalPoint(new mxPoint(S[0]+30,X),!0),F.geometry.setTerminalPoint(new mxPoint(S[2]-30,X),!1)):1==H?(F.geometry.setTerminalPoint(new mxPoint(S[0]+30,X),!0),F.geometry.setTerminalPoint(new mxPoint(S[2]-30,X),!1)):2==H&&(F.geometry.setTerminalPoint(new mxPoint(S[0]+30,X),!1),F.geometry.setTerminalPoint(new mxPoint(S[2]-30,X),!0)),F.edge=!0,F=e.graph.addCell(F,k),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[F]));var Y=0;for(h=0;h<b.length;h++){var w=b[h].getValue();if("Connector"==w.tagName){var G=e.graph.getChildEdges(b[h]);if(null!=G)for(var N=0;N<G.length;N++)G[N].geometry.sourcePoint.y==G[N].geometry.targetPoint.y&&G[N].geometry.targetPoint.y>=D&&(Y=G[N].geometry.targetPoint.y)}}var Z=L.geometry;Z.y=Y+50,e.graph.model.setGeometry(L,Z);var d=e.graph.getCellGeometry(f).clone();d.height=Z.y+Z.height,e.graph.model.setGeometry(f,d);var q=F.geometry,J=U.geometry,Q=K.geometry;if(0==H)var $={x:J.sourcePoint.x,y:J.sourcePoint.y},ee={x:J.targetPoint.x,y:J.targetPoint.y},te={x:Q.sourcePoint.x,y:Q.sourcePoint.y},oe={x:Q.targetPoint.x,y:Q.targetPoint.y},re={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},ge={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y};else if(1==H)var $={x:J.sourcePoint.x,y:J.sourcePoint.y},ee={x:J.targetPoint.x,y:J.targetPoint.y},te={x:Q.sourcePoint.x,y:Q.sourcePoint.y},oe={x:Q.targetPoint.x,y:Q.targetPoint.y},re={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},ge={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y};else if(2==H)var $={x:J.targetPoint.x,y:J.targetPoint.y},ee={x:J.sourcePoint.x,y:J.sourcePoint.y},te={x:Q.targetPoint.x,y:Q.targetPoint.y},oe={x:Q.sourcePoint.x,y:Q.sourcePoint.y},re={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},ge={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y};if(c.checked)var ie=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var ie=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");ie.cursor="hand",0==H?(ie.offset.x=(oe.x-ee.x-60)/2,console.log("specialcase 0 overlay offset = ",(oe.x-ee.x-60)/2)):2==H&&(ie.offset.x=(oe.x-ee.x-60)/2,console.log("specialcase 2 overlay offset",(oe.x-ee.x-60)/2)),e.graph.addCellOverlay(F,ie),ie.addListener(mxEvent.CLICK,function(){if(0==H)var o={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y},r={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y},i={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},n={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},l={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},m={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y};else if(2==H)var o={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y},r={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y},i={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},n={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},l={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},m={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y};e.graph.clearSelection();var d=prompt("New Element Name","Enter here"),y=0;if(v=g(),null!=d){for(h=0;h<v.length;h++)0==d.localeCompare(v[h])&&y++;if(0<y)var s=e.templates.rectangle;else var s=e.templates.rounded;var c=e.graph.model.cloneCell(s);c.setAttribute("label",d);var p=c.getGeometry();p.width=Math.round(a(d,"11px arial"))+30,e.graph.model.setGeometry(c,p);var x=[],P=e.graph.model.getChildren(f);console.log(P),console.log(r.x);var C=r.x;for(h=0;h<P.length;h++){var b=P[h].getValue();if("Rect"==b.tagName||"Roundrect"==b.tagName){var w=P[h].getGeometry();if(w.x>=r.x&&w.y==l.y-10&&w.x<=i.x){if(w.x+w.width>=C){C=w.x+w.width;var E=w}x.push(P[h])}}}var G=e.graph.model.add(f,c,u),N=e.graph.getCellGeometry(G).clone();if(N.height=20,N.y=l.y-10,"undefined"!=typeof E){var O=40;for(h=0;h<x.length;h++)O+=x[h].getGeometry().width+40;if(O+=N.width,O>Math.abs(m.x-l.x)){for(h=0;h<P.length;h++){var b=P[h].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&P[h].geometry.x>=m.x){var T=P[h].geometry;T.x+=N.width+40,e.graph.model.setGeometry(P[h],T)}}for(h=0;h<P.length;h++){var B=P[h].getStyle();if("ellipse"==B&&P[h].geometry.x>m.x){var T=P[h].geometry;T.x+=N.width+40,e.graph.model.setGeometry(P[h],T)}var A=m.x,b=P[h].getValue();if("Connector"==b.tagName)for(var I=e.graph.getChildEdges(P[h]),R=0;R<I.length;R++){if(I[R].geometry.sourcePoint.x>=A){var V=I[R].geometry;if(V.sourcePoint.x+=N.width+40,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(I[R].geometry.targetPoint.x>=A){var V=I[R].geometry;if(V.targetPoint.x+=N.width+40,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(null!=I[R].geometry.points&&I[R].geometry.points[0].x>=A){var V=I[R].geometry;V.points[0].x+=N.width+40,e.graph.model.setGeometry(I[R],V)}}}N.x=C+40}else N.x=C+40}else{if(N.width+20>Math.abs(q.targetPoint.x-q.sourcePoint.x)){var P=e.graph.model.getChildren(f);for(h=0;h<P.length;h++){var b=P[h].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&P[h].geometry.x>=m.x){var T=P[h].geometry;T.x+=N.width+10,e.graph.model.setGeometry(P[h],T)}}for(h=0;h<P.length;h++){var B=P[h].getStyle();if("ellipse"==B&&P[h].geometry.x>m.x){var T=P[h].geometry;T.x+=N.width+10,e.graph.model.setGeometry(P[h],T)}var A=m.x,b=P[h].getValue();if("Connector"==b.tagName)for(var I=e.graph.getChildEdges(P[h]),R=0;R<I.length;R++){if(I[R].geometry.sourcePoint.x>=A){var V=I[R].geometry;if(V.sourcePoint.x+=N.width+10,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(I[R].geometry.targetPoint.x>=A){var V=I[R].geometry;if(V.targetPoint.x+=N.width+10,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(null!=I[R].geometry.points&&I[R].geometry.points[0].x>=A){var V=I[R].geometry;console.log("point before moving",V.points[0].x),V.points[0].x+=N.width+10,e.graph.model.setGeometry(I[R],V),console.log("after moving ",V.points[0].x)}}}}N.x=q.targetPoint.x>q.sourcePoint.x?q.sourcePoint.x+10:q.targetPoint.x+10}e.graph.model.setGeometry(G,N);var L=0,P=e.graph.model.getChildren(f);for(h=0;h<P.length;h++){var S=P[h].getGeometry();S.x>L&&(L=S.x+S.width)}var M=f.getGeometry();for(M.width=L,e.graph.model.setGeometry(f,M),h=0;h<P.length;h++){var B=P[h].getStyle();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==B){var _=P[h].getGeometry();_.x=_.x=Math.round(M.width/2)-_.width/2,e.graph.model.setGeometry(P[h],_);break}}e.graph.refresh()}}),S.length=0,M.destroy(),c.checked=!0,p(e),r()}}}},mouseMove:function(){},mouseUp:function(){},dragEnter:function(){},dragLeave:function(){}}),c.checked)var _=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var _=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");_.cursor="hand",e.graph.addCellOverlay(k,_),_.addListener(mxEvent.CLICK,function(){e.graph.clearSelection(),v=g();var o=prompt("New Element Name","Enter here"),r=0;if(null!=o){for(n=0;n<v.length;n++)0==o.localeCompare(v[n])&&r++;if(0<r)var i=e.templates.rectangle;else var i=e.templates.rounded;var l=e.graph.model.cloneCell(i);l.setAttribute("label",o);var m=l.getGeometry();m.width=1==o.length?Math.round(a(o,"11px arial"))+10:Math.round(a(o,"11px arial"))+30,e.graph.model.setGeometry(l,m);var d=e.graph.model.getChildren(f),y=0;for(n=0;n<d.length;n++){var s=d[n].getValue();if("Rect"==s.tagName||"Roundrect"==s.tagName){var h=d[n].getGeometry();if(h.x>y&&h.y==I.y-6){y=h.x+h.width}}}for(n=0;n<d.length;n++){var s=d[n].getValue();if("Connector"==s.tagName){for(var c=e.graph.getChildEdges(d[n]),p=0;p<c.length;p++)c[p].geometry.sourcePoint.x>y&&(y=c[p].geometry.sourcePoint.x),c[p].geometry.targetPoint.x>y&&(y=c[p].geometry.targetPoint.x);break}}var x=e.graph.model.add(f,l,u),P=e.graph.getCellGeometry(x).clone();P.height=20,P.y=I.y-6,P.x="undefined"==typeof h?A.x+A.width+40:y+40,e.graph.model.setGeometry(x,P);var C=0,b=e.graph.model.getChildren(f);for(console.log(b),n=0;n<b.length;n++){var w=d[n].geometry;w.x+w.width>C&&(C=w.x+w.width)}var E=f.geometry;E.width=1.15*C,I.x=E.width-10,e.graph.model.setGeometry(T,I),e.graph.model.setGeometry(f,E);var G=e.graph.getCellGeometry(L).clone();G.x=Math.round(E.width/2)-G.width/2,e.graph.model.setGeometry(L,G),e.graph.refresh()}}),_.getBounds=function(e){var o=mxCellOverlay.prototype.getBounds.apply(this,arguments);if(e.view.graph.getModel().isEdge(e.cell)){var r=e.view.getPoint(e,{x:1,y:0,relative:!0});o.x=r.x-o.width/2,o.y=r.y-o.height/2}return o},e.graph.refresh()}})}