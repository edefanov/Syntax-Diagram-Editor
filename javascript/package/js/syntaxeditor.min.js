function createEditor(e){var o=null,r=function(){var o=document.getElementById("splash");if(null!=o)try{mxEvent.release(o),mxEffects.fadeOut(o,100,!0)}catch(r){o.parentNode.removeChild(o)}};try{if(!mxClient.isBrowserSupported())mxUtils.error("Browser is not supported!",200,!1);else{mxObjectCodec.allowEval=!0;var g=mxUtils.load(e).getDocumentElement();o=new mxEditor(g),mxObjectCodec.allowEval=!1,o.graph.createPanningManager=function(){var e=new mxPanningManager(this);return e.border=30,e},o.graph.allowAutoPanning=!0,o.graph.timerAutoScroll=!0;var i=document.title,n=function(e){document.title=i+" - "+e.getTitle()};o.addListener(mxEvent.OPEN,n),o.addListener(mxEvent.ROOT,n),n(o),r()}}catch(o){throw r(),mxUtils.alert("Cannot start application: "+o.message),o}return o}function onInit(e){function o(){for(var o=e.graph.getDefaultParent(),i=e.graph.getChildCells(o),l=0;l<i.length;l++){var m=e.graph.getChildEdges(i[l])[0],d=i[l],y=e.graph.getChildCells(i[l])[0],s=e.graph.getChildCells(i[l])[1],h=y.geometry,p=s.geometry,u=a(e.graph.getChildCells(i[l]),"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0");if(c.checked)var P=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var P=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");P.cursor="hand",e.graph.addCellOverlay(m,P);var C=g();P.addListener(mxEvent.CLICK,function(){e.graph.clearSelection();var o=prompt("New Element Name","Enter here"),r=0;if(null!=o){for(f=0;f<C.length;f++)0==o.localeCompare(C[f])&&r++;if(0<r)var g=e.templates.rectangle;else var g=e.templates.rounded;var i=e.graph.model.cloneCell(g);i.setAttribute("label",o);var a=i.getGeometry();a.width=1==o.length?Math.round(n(o,"11px arial"))+10:Math.round(n(o,"11px arial"))+30,e.graph.model.setGeometry(i,a);var l=e.graph.model.getChildren(d),m=0;for(f=0;f<l.length;f++){var h=l[f].getValue();if("Rect"==h.tagName||"Roundrect"==h.tagName){var c=l[f].getGeometry();if(c.x>m&&c.y==p.y-6){m=c.x+c.width}}}for(f=0;f<l.length;f++){var h=l[f].getValue();if("Connector"==h.tagName){for(var x=e.graph.getChildEdges(l[f]),P=0;P<x.length;P++)x[P].geometry.sourcePoint.x>m&&(m=x[P].geometry.sourcePoint.x),x[P].geometry.targetPoint.x>m&&(m=x[P].geometry.targetPoint.x);break}}var b=e.graph.model.add(d,i),w=e.graph.getCellGeometry(b).clone();w.height=20,w.y=p.y-6,w.x="undefined"==typeof c?y.geometry.x+y.geometry.width+40:m+40,e.graph.model.setGeometry(b,w);var v=0,E=e.graph.model.getChildren(d);for(f=0;f<E.length;f++){var G=l[f].getGeometry();G.x+G.width>v&&(v=G.x+G.width)}var N=d.geometry;N.width=1.15*v,p.x=N.width-10,e.graph.model.setGeometry(s,p),e.graph.model.setGeometry(d,N);var O=e.graph.getCellGeometry(u).clone();O.x=Math.round(N.width/2)-O.width/2,e.graph.model.setGeometry(u,O),e.graph.refresh()}}),P.getBounds=function(e){var o=mxCellOverlay.prototype.getBounds.apply(this,arguments);if(e.view.graph.getModel().isEdge(e.cell)){var r=e.view.getPoint(e,{x:1,y:0,relative:!0});o.x=r.x-o.width/2,o.y=r.y-o.height/2}return o},e.graph.refresh();for(var b=e.graph.getChildEdges(m),j=0;j<b.length;j++)if(b[j].geometry.sourcePoint.y==b[j].geometry.targetPoint.y){var w=b[j],v=b[j-1],E=b[j-2],G={x:Math.max(E.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:Math.max(E.geometry.targetPoint.y,E.geometry.sourcePoint.y)},N={x:Math.min(E.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:Math.min(E.geometry.targetPoint.y,E.geometry.sourcePoint.y)},O={x:Math.max(v.geometry.targetPoint.x,v.geometry.sourcePoint.x),y:Math.max(v.geometry.targetPoint.y,v.geometry.sourcePoint.y)},T={x:Math.min(v.geometry.targetPoint.x,v.geometry.sourcePoint.x),y:Math.min(v.geometry.targetPoint.y,v.geometry.sourcePoint.y)},B={x:Math.max(w.geometry.targetPoint.x,w.geometry.sourcePoint.x),y:w.geometry.targetPoint.y},A={x:Math.min(w.geometry.targetPoint.x,E.geometry.sourcePoint.x),y:w.geometry.targetPoint.y};if(c.checked)var I=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var I=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");I.cursor="hand",I.offset.x=(O.x-G.x-60)/2,e.graph.addCellOverlay(w,I),I.addListener(mxEvent.CLICK,function(){e.graph.clearSelection();var o=prompt("New Element Name","Enter here"),r=0;if(C=g(),null!=o){for(f=0;f<C.length;f++)0==o.localeCompare(C[f])&&r++;if(0<r)var i=e.templates.rectangle;else var i=e.templates.rounded;var a=e.graph.model.cloneCell(i);a.setAttribute("label",o);var l=a.getGeometry();l.width=Math.round(n(o,"11px arial"))+30,e.graph.model.setGeometry(a,l);var m=[],y=e.graph.model.getChildren(d),s=G.x;for(f=0;f<y.length;f++){var h=y[f].getValue();if("Rect"==h.tagName||"Roundrect"==h.tagName){var c=y[f].getGeometry();if(c.x>=G.x&&c.y==A.y-10&&c.x<=T.x){if(c.x+c.width>=s){s=c.x+c.width;var x=c}m.push(y[f])}}}var p=e.graph.model.add(d,a),u=e.graph.getCellGeometry(p).clone();if(u.height=20,u.y=A.y-10,"undefined"!=typeof x){var P=40;for(f=0;f<m.length;f++)P+=m[f].getGeometry().width+40;if(P+=u.width,P>Math.abs(B.x-A.x)){for(f=0;f<y.length;f++){var h=y[f].getValue();if(("Rect"==h.tagName||"Roundrect"==h.tagName)&&y[f].geometry.x>=B.x){var b=y[f].geometry;b.x+=u.width+40,e.graph.model.setGeometry(y[f],b)}}for(f=0;f<y.length;f++){var w=y[f].getStyle();if("ellipse"==w&&y[f].geometry.x>B.x){var b=y[f].geometry;b.x+=u.width+40,e.graph.model.setGeometry(y[f],b)}var v=B.x,h=y[f].getValue();if("Connector"==h.tagName)for(var E=e.graph.getChildEdges(y[f]),N=0;N<E.length;N++){if(E[N].geometry.sourcePoint.x>=v){var O=E[N].geometry;if(O.sourcePoint.x+=u.width+40,e.graph.model.setGeometry(E[N],O),null!=e.graph.getCellOverlays(E[N])){var I=e.graph.getCellOverlays(E[N])[0];I.image=new mxImage("images/add.png",28,28),I.offset.x=Math.abs((O.targetPoint.x-O.sourcePoint.x)/2)}}if(E[N].geometry.targetPoint.x>=v){var O=E[N].geometry;if(O.targetPoint.x+=u.width+40,e.graph.model.setGeometry(E[N],O),null!=e.graph.getCellOverlays(E[N])){var I=e.graph.getCellOverlays(E[N])[0];I.image=new mxImage("images/add.png",28,28),I.offset.x=Math.abs((O.targetPoint.x-O.sourcePoint.x)/2)}}if(null!=E[N].geometry.points&&E[N].geometry.points[0].x>=v){var O=E[N].geometry;O.points[0].x+=u.width+40,e.graph.model.setGeometry(E[N],O)}}}u.x=s+40}else u.x=s+40}else{if(u.width+20>Math.abs(cellE3G.targetPoint.x-cellE3G.sourcePoint.x)){var y=e.graph.model.getChildren(d);for(f=0;f<y.length;f++){var h=y[f].getValue();if(("Rect"==h.tagName||"Roundrect"==h.tagName)&&y[f].geometry.x>=B.x){var b=y[f].geometry;b.x+=u.width+10,e.graph.model.setGeometry(y[f],b)}}for(f=0;f<y.length;f++){var w=y[f].getStyle();if("ellipse"==w&&y[f].geometry.x>B.x){var b=y[f].geometry;b.x+=u.width+10,e.graph.model.setGeometry(y[f],b)}var v=B.x,h=y[f].getValue();if("Connector"==h.tagName)for(var E=e.graph.getChildEdges(y[f]),N=0;N<E.length;N++){if(E[N].geometry.sourcePoint.x>=v){var O=E[N].geometry;if(O.sourcePoint.x+=u.width+10,e.graph.model.setGeometry(E[N],O),null!=e.graph.getCellOverlays(E[N])){var I=e.graph.getCellOverlays(E[N])[0];I.image=new mxImage("images/add.png",28,28),I.offset.x=Math.abs((O.targetPoint.x-O.sourcePoint.x)/2)}}if(E[N].geometry.targetPoint.x>=v){var O=E[N].geometry;if(O.targetPoint.x+=u.width+10,e.graph.model.setGeometry(E[N],O),null!=e.graph.getCellOverlays(E[N])){var I=e.graph.getCellOverlays(E[N])[0];I.image=new mxImage("images/add.png",28,28),I.offset.x=Math.abs((O.targetPoint.x-O.sourcePoint.x)/2)}}if(null!=E[N].geometry.points&&E[N].geometry.points[0].x>=v){var O=E[N].geometry;O.points[0].x+=u.width+10,e.graph.model.setGeometry(E[N],O)}}}}u.x=cellE3G.targetPoint.x>cellE3G.sourcePoint.x?cellE3G.sourcePoint.x+10:cellE3G.targetPoint.x+10}e.graph.model.setGeometry(p,u);var R=0,y=e.graph.model.getChildren(d);for(f=0;f<y.length;f++){var V=y[f].getGeometry();V.x>R&&(R=V.x+V.width)}var k=d.getGeometry();for(k.width=R,e.graph.model.setGeometry(d,k),f=0;f<y.length;f++){var w=y[f].getStyle();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==w){var L=y[f].getGeometry();L.x=L.x=Math.round(k.width/2)-L.width/2,e.graph.model.setGeometry(y[f],L);break}}e.graph.refresh()}})}var R=[],V=null;e.graph.addMouseListener({currentState:null,mouseDown:function(o,a){if(null!=this.currentState&&this.dragLeave(a.getEvent(),this.currentState),e.graph.model.isVertex(a.getCell())){var l=a.getCell(),h=e.graph.getCellGeometry(l).clone(),p=e.graph.getCellGeometry(d).clone();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==l.style&&l.parent==d){for(var P=e.graph.getChildCells(d),b=[],f=0;f<P.length;f++)if("Rect"==P[f].value.tagName||"Roundrect"==P[f].value.tagName){var w=!1,v=!1,E=P[f].geometry.x,G=e.graph.model.getChildren(d);for(z=0;z<G.length;z++){var N=G[z].getValue();if("Connector"==N.tagName){var O=e.graph.getChildEdges(G[z]);if(null!=O)for(var T=0;T<O.length;T++)if(E+P[f].geometry.width<Math.max(O[T].geometry.targetPoint.x,O[T].geometry.sourcePoint.x)&&E+P[f].geometry.width>Math.min(O[T].geometry.targetPoint.x,O[T].geometry.sourcePoint.x)&&O[T].geometry.targetPoint.y==O[T].geometry.sourcePoint.y&&P[f].geometry.y<O[T].geometry.sourcePoint.y-10&&(v=!0),E<Math.max(O[T].geometry.targetPoint.x,O[T].geometry.sourcePoint.x)&&E>Math.min(O[T].geometry.targetPoint.x,O[T].geometry.sourcePoint.x)&&O[T].geometry.targetPoint.y==O[T].geometry.sourcePoint.y&&P[f].geometry.y<O[T].geometry.sourcePoint.y-10){w=!0;break}}}var B=0;if(P[f].geometry.y>G[1].geometry.y-6&&!1==w){var O=e.graph.getChildEdges(G[2]);if(null!=O)for(var T=0;T<O.length;T++){var A=Math.min(O[T].geometry.targetPoint.x,O[T].geometry.sourcePoint.x),I=Math.max(O[T].geometry.targetPoint.x,O[T].geometry.sourcePoint.x);if(O[T].geometry.targetPoint.y==O[T].geometry.sourcePoint.y&&O[T].geometry.sourcePoint.y-10==P[f].geometry.y&&P[f].geometry.x>A&&P[f].geometry.x+P[f].geometry.width<I){for(var k=0;k<P.length;k++)if(O[T].geometry.sourcePoint.y-10==P[k].geometry.y&&P[k].geometry.x>A&&P[k].geometry.x+P[k].geometry.width<I&&P[f].geometry.x<P[k].geometry.x){B++;break}break}}}if(0==B&&!v&&P[f].geometry.y>G[1].geometry.y-6){var L=e.graph.insertVertex(d,null,"",P[f].geometry.x+P[f].geometry.width+10,P[f].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");b.unshift(L)}if(!w){var L=e.graph.insertVertex(d,null,"",P[f].geometry.x-30,P[f].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");b.unshift(L),w=!1}}var L=e.graph.insertVertex(d,null,"",s.geometry.x-20,s.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");b.unshift(L);var L=e.graph.insertVertex(d,null,"",y.geometry.x+y.geometry.width+10,y.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");b.unshift(L);var S=document.createElement("div");S.innerHTML="<table height=100%> <tr> <td> <span id='vertTip'> Select the first (start) point </span> </td></tr><tr><td> <button style=\"float:bottom\" id='closeBtn' style='align:right'>Cancel</button> </td></tr></table> ",V=new mxWindow("Tip",S,a.getX(),a.getY(),250,void 0,!1,!0),V.setLocation=function(e,o){e=a.getX(),o=a.getY(),mxWindow.prototype.setLocation.apply(this,arguments)},document.getElementById("closeBtn").onclick=function(){for(var o=0;o<b.length;o++)e.graph.model.remove(b[o]);V.destroy(),c.checked=!0,x(e),R.length=0},c.checked=!1,x(e),V.setVisible(!0)}if("image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==l.style&&l.parent==d){4>R.length&&(R.push(h.x+h.width/2),R.push(h.y+10));var P=e.graph.getChildCells(d);if(2==R.length){for(var f=0;f<P.length;f++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==P[f].style&&h.y!=P[f].geometry.y&&e.graph.model.remove(P[f]);document.getElementById("vertTip").innerHTML="Select the second (end) point"}if(4==R.length){for(var f=0;f<P.length;f++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==P[f].style&&e.graph.model.remove(P[f]);var M=y.geometry.y+y.geometry.height/2+30,G=e.graph.model.getChildren(d);for(f=0;f<G.length;f++){var N=G[f].getValue();if("Connector"==N.tagName){var O=e.graph.getChildEdges(G[f]);if(null!=O)for(var T=0;T<O.length;T++)O[T].geometry.sourcePoint.y==O[T].geometry.targetPoint.y&&O[T].geometry.targetPoint.y>=M&&(O[T].geometry.sourcePoint.x>=R[0]&&O[T].geometry.targetPoint.x<=R[2]?M=O[T].geometry.targetPoint.y:O[T].geometry.targetPoint.x>=R[0]&&O[T].geometry.sourcePoint.x<=R[2]&&(M=O[T].geometry.targetPoint.y))}}var _=M+30,D=0;if(R[0]==R[2]&&R[1]==R[3]&&(D=1),R[0]>R[2]){D=2;var H=R[0];R[0]=R[2],R[2]=H}var W=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==D?(W.geometry.setTerminalPoint(new mxPoint(R[0],R[1]),!0),W.geometry.setTerminalPoint(new mxPoint(R[0]+30,_),!1)):1==D?(W.geometry.setTerminalPoint(new mxPoint(R[0],R[1]),!0),W.geometry.setTerminalPoint(new mxPoint(R[0]+30,_),!1)):2==D&&(W.geometry.setTerminalPoint(new mxPoint(R[0]+15,R[1]),!1),W.geometry.points=[new mxPoint(R[0],R[1]+5)],W.geometry.setTerminalPoint(new mxPoint(R[0]+30,_),!0)),W.edge=!0,W=e.graph.addCell(W,m),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[W]));var X=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==D?(X.geometry.setTerminalPoint(new mxPoint(R[2]-30,_),!0),X.geometry.setTerminalPoint(new mxPoint(R[2],R[3]),!1)):1==D?(X.geometry.setTerminalPoint(new mxPoint(R[2]-30,_),!1),X.geometry.setTerminalPoint(new mxPoint(R[2],R[3]),!0)):2==D&&(X.geometry.setTerminalPoint(new mxPoint(R[2]-30,_),!1),X.geometry.points=[new mxPoint(R[2],R[3]+5)],X.geometry.setTerminalPoint(new mxPoint(R[2]-15,R[3]),!0)),X.edge=!0,X=e.graph.addCell(X,m),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[X]));var U=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==D?(U.geometry.setTerminalPoint(new mxPoint(R[0]+30,_),!0),U.geometry.setTerminalPoint(new mxPoint(R[2]-30,_),!1)):1==D?(U.geometry.setTerminalPoint(new mxPoint(R[0]+30,_),!0),U.geometry.setTerminalPoint(new mxPoint(R[2]-30,_),!1)):2==D&&(U.geometry.setTerminalPoint(new mxPoint(R[0]+30,_),!1),U.geometry.setTerminalPoint(new mxPoint(R[2]-30,_),!0)),U.edge=!0,U=e.graph.addCell(U,m),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[U]));var K=u.geometry;K.y=M+50,e.graph.model.setGeometry(u,K);var p=e.graph.getCellGeometry(d).clone();p.height=K.y+K.height,e.graph.model.setGeometry(d,p);var F=U.geometry,Y=W.geometry,Z=X.geometry;if(0==D)var q={x:W.geometry.sourcePoint.x,y:W.geometry.sourcePoint.y},J={x:W.geometry.targetPoint.x,y:W.geometry.targetPoint.y},Q={x:X.geometry.sourcePoint.x,y:X.geometry.sourcePoint.y},$={x:X.geometry.targetPoint.x,y:X.geometry.targetPoint.y},ee={x:F.sourcePoint.x,y:F.sourcePoint.y},te={x:F.targetPoint.x,y:F.targetPoint.y};else if(1==D)var q={x:W.geometry.sourcePoint.x,y:W.geometry.sourcePoint.y},J={x:W.geometry.targetPoint.x,y:W.geometry.targetPoint.y},Q={x:X.geometry.sourcePoint.x,y:X.geometry.sourcePoint.y},$={x:X.geometry.targetPoint.x,y:X.geometry.targetPoint.y},ee={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y},te={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y};else if(2==D)var q={x:W.geometry.targetPoint.x,y:W.geometry.targetPoint.y},J={x:W.geometry.sourcePoint.x,y:W.geometry.sourcePoint.y},Q={x:X.geometry.targetPoint.x,y:X.geometry.targetPoint.y},$={x:X.geometry.sourcePoint.x,y:X.geometry.sourcePoint.y},ee={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y},te={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y};if(c.checked)var oe=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var oe=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");oe.cursor="hand",0==D?oe.offset.x=($.x-J.x-60)/2:2==D&&(oe.offset.x=($.x-J.x-60)/2),e.graph.addCellOverlay(U,oe),oe.addListener(mxEvent.CLICK,function(){if(0==D)var o={x:W.geometry.sourcePoint.x,y:W.geometry.sourcePoint.y},r={x:W.geometry.targetPoint.x,y:W.geometry.targetPoint.y},i={x:X.geometry.sourcePoint.x,y:X.geometry.sourcePoint.y},a={x:X.geometry.targetPoint.x,y:X.geometry.targetPoint.y},l={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y},m={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y};else if(2==D)var o={x:W.geometry.targetPoint.x,y:W.geometry.targetPoint.y},r={x:W.geometry.sourcePoint.x,y:W.geometry.sourcePoint.y},i={x:X.geometry.targetPoint.x,y:X.geometry.targetPoint.y},a={x:X.geometry.sourcePoint.x,y:X.geometry.sourcePoint.y},l={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y},m={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y};e.graph.clearSelection();var y=prompt("New Element Name","Enter here"),s=0;if(C=g(),null!=y){for(f=0;f<C.length;f++)0==y.localeCompare(C[f])&&s++;if(0<s)var h=e.templates.rectangle;else var h=e.templates.rounded;var c=e.graph.model.cloneCell(h);c.setAttribute("label",y);var x=c.getGeometry();x.width=Math.round(n(y,"11px arial"))+30,e.graph.model.setGeometry(c,x);var p=[],u=e.graph.model.getChildren(d),P=r.x;for(f=0;f<u.length;f++){var b=u[f].getValue();if("Rect"==b.tagName||"Roundrect"==b.tagName){var w=u[f].getGeometry();if(w.x>=r.x&&w.y==l.y-10&&w.x<=i.x){if(w.x+w.width>=P){P=w.x+w.width;var v=w}p.push(u[f])}}}var E=e.graph.model.add(d,c),G=e.graph.getCellGeometry(E).clone();if(G.height=20,G.y=l.y-10,"undefined"!=typeof v){var N=40;for(f=0;f<p.length;f++)N+=p[f].getGeometry().width+40;if(N+=G.width,N>Math.abs(m.x-l.x)){for(f=0;f<u.length;f++){var b=u[f].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&u[f].geometry.x>=m.x){var O=u[f].geometry;O.x+=G.width+40,e.graph.model.setGeometry(u[f],O)}}for(f=0;f<u.length;f++){var T=u[f].getStyle();if("ellipse"==T&&u[f].geometry.x>m.x){var O=u[f].geometry;O.x+=G.width+40,e.graph.model.setGeometry(u[f],O)}var B=m.x,b=u[f].getValue();if("Connector"==b.tagName)for(var A=e.graph.getChildEdges(u[f]),I=0;I<A.length;I++){if(A[I].geometry.sourcePoint.x>=B){var R=A[I].geometry;if(R.sourcePoint.x+=G.width+40,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(A[I].geometry.targetPoint.x>=B){var R=A[I].geometry;if(R.targetPoint.x+=G.width+40,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(null!=A[I].geometry.points&&A[I].geometry.points[0].x>=B){var R=A[I].geometry;R.points[0].x+=G.width+40,e.graph.model.setGeometry(A[I],R)}}}G.x=P+40}else G.x=P+40}else{if(G.width+20>Math.abs(F.targetPoint.x-F.sourcePoint.x)){var u=e.graph.model.getChildren(d);for(f=0;f<u.length;f++){var b=u[f].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&u[f].geometry.x>=m.x){var O=u[f].geometry;O.x+=G.width+10,e.graph.model.setGeometry(u[f],O)}}for(f=0;f<u.length;f++){var T=u[f].getStyle();if("ellipse"==T&&u[f].geometry.x>m.x){var O=u[f].geometry;O.x+=G.width+10,e.graph.model.setGeometry(u[f],O)}var B=m.x,b=u[f].getValue();if("Connector"==b.tagName)for(var A=e.graph.getChildEdges(u[f]),I=0;I<A.length;I++){if(A[I].geometry.sourcePoint.x>=B){var R=A[I].geometry;if(R.sourcePoint.x+=G.width+10,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(A[I].geometry.targetPoint.x>=B){var R=A[I].geometry;if(R.targetPoint.x+=G.width+10,e.graph.model.setGeometry(A[I],R),null!=e.graph.getCellOverlays(A[I])){var V=e.graph.getCellOverlays(A[I])[0];V.image=new mxImage("images/add.png",28,28),V.offset.x=Math.abs((R.targetPoint.x-R.sourcePoint.x)/2)}}if(null!=A[I].geometry.points&&A[I].geometry.points[0].x>=B){var R=A[I].geometry;R.points[0].x+=G.width+10,e.graph.model.setGeometry(A[I],R)}}}}G.x=F.targetPoint.x>F.sourcePoint.x?F.sourcePoint.x+10:F.targetPoint.x+10}e.graph.model.setGeometry(E,G);var k=0,u=e.graph.model.getChildren(d);for(f=0;f<u.length;f++){var L=u[f].getGeometry();L.x>k&&(k=L.x+L.width)}var S=d.getGeometry();for(S.width=k,e.graph.model.setGeometry(d,S),f=0;f<u.length;f++){var T=u[f].getStyle();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==T){var M=u[f].getGeometry();M.x=M.x=Math.round(S.width/2)-M.width/2,e.graph.model.setGeometry(u[f],M);break}}e.graph.refresh()}}),R.length=0,V.destroy(),c.checked=!0,x(e),r()}}}},mouseMove:function(){},mouseUp:function(){},dragEnter:function(){},dragLeave:function(){}})}}function r(){var o=e.graph.getDefaultParent(),r=e.graph.getChildCells(o);if(0<r.length){for(var g=0;g<r.length-1;g++){var n=r[g].geometry,a=r[g+1].geometry;n.y+n.height>a.y&&(a.y=n.y+n.height,e.graph.model.setGeometry(r[g+1],a))}e.graph.refresh()}}function g(){var o=[],r=e.graph.getDefaultParent(),g=e.graph.model.getChildCells(r);if(0<g.length)for(var g=e.graph.getChildCells(r),n=0;n<g.length;n++)o.push(g[n].getAttribute("label").slice(0,-1));return o}function n(e,o){var r=n.canvas||(n.canvas=document.createElement("canvas")),g=r.getContext("2d");g.font=o;var i=g.measureText(e);return i.width}function a(e,o){for(var r=null,g=0;g<e.length;g++)if(e[g].getStyle()==o){r=e[g];break}return r}mxGraphHandler.prototype.guidesEnabled=!0,mxGuide.prototype.isEnabledForEvent=function(e){return!mxEvent.isAltDown(e)},mxEdgeHandler.prototype.snapToTerminals=!0,mxConnectionHandler.prototype.connectImage=new mxImage("images/connector.gif",16,16),e.graph.setConnectable(!1),e.graph.connectionHandler.setCreateTarget(!0);var l=document.getElementById("graph"),m=document.getElementById("toolbar");l.style.width=.95*window.innerWidth-m.getBoundingClientRect().width,l.style.height=.95*window.innerHeight-document.getElementById("header").getBoundingClientRect().height-28-document.getElementById("mainActions").getBoundingClientRect().height-document.getElementById("zoomActions").getBoundingClientRect().height-document.getElementById("source").getBoundingClientRect().height,console.log(window.innerHeight);window.addEventListener("resize",function(o){var e=o.target.outerWidth,r=o.target.outerHeight;l.style.width=.95*window.innerWidth-m.getBoundingClientRect().width,l.style.height=.95*window.innerHeight-document.getElementById("header").getBoundingClientRect().height-document.getElementById("mainActions").getBoundingClientRect().height-document.getElementById("zoomActions").getBoundingClientRect().height}),mxEvent.addMouseWheelListener(function(o,r){mxEvent.isConsumed(o)||(r&&!1==document.getElementById("source").checked?e.execute("zoomIn"):!1==document.getElementById("source").checked&&e.execute("zoomOut"),mxEvent.consume(o))});var d=document.getElementById("xml"),y=e.graph.container,s=document.getElementById("source");s.checked=!1;var h=function(e){if(s.checked){y.style.display="none",d.style.display="inline";var o=new mxCodec,r=o.encode(e.graph.getModel());d.value=mxUtils.getPrettyXml(r),d.originalValue=d.value,d.focus()}else{if(y.style.display="",d.value!=d.originalValue){var g=mxUtils.parseXml(d.value),i=new mxCodec(g);i.decode(g.documentElement,e.graph.getModel())}d.originalValue=null,mxClient.IS_IE&&mxUtils.clearSelection(),d.style.display="none",e.execute("actualSize"),e.graph.container.focus()}};e.addAction("switchView",h),mxEvent.addListener(s,"click",function(){e.execute("switchView")});var c=document.getElementById("overlayToggle");c.checked=!0;var x=function(e){if(c.checked){var o=e.graph.getDefaultParent(),r=e.graph.getChildCells(o);if(0<r.length)for(var g,n=0;n<r.length;n++){g=e.graph.getChildEdges(r[n]);for(var a=0;a<g.length;a++){if(null!=e.graph.getCellOverlays(g[a])){var l=e.graph.getCellOverlays(g[a])[0];l.image=new mxImage("images/add.png",28,28)}var m=g[a].getValue();if("Connector"==m.tagName)for(var d=e.graph.getChildEdges(g[a]),y=0;y<d.length;y++)if(null!=e.graph.getCellOverlays(d[y])){var l=e.graph.getCellOverlays(d[y])[0];l.image=new mxImage("images/add.png",28,28)}}for(var s,g=r[n].children,a=0;a<g.length;a++)s=g[a].style,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==s&&(g[a].visible=!0)}e.graph.refresh()}else{var o=e.graph.getDefaultParent(),h=e.graph.model.getChildCount(o);if(0<h)for(var g,r=e.graph.getChildCells(o),n=0;n<h;n++){g=e.graph.getChildEdges(r[n]);for(var a=0;a<g.length;a++){if(null!=e.graph.getCellOverlays(g[a])){var l=e.graph.getCellOverlays(g[a])[0];l.image=new mxImage("images/add.png",0,0)}var m=g[a].getValue();if("Connector"==m.tagName)for(var d=e.graph.getChildEdges(g[a]),y=0;y<d.length;y++)if(null!=e.graph.getCellOverlays(d[y])){var l=e.graph.getCellOverlays(d[y])[0];l.image=new mxImage("images/add.png",0,0)}}for(var s,g=r[n].children,a=0;a<g.length;a++)s=g[a].style,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==s&&(g[a].visible=!1)}e.graph.refresh()}};e.addAction("toggleOverlay",x),mxEvent.addListener(c,"click",function(){e.execute("toggleOverlay")});e.addAction("popupOverlayToggle",function(){c.checked=!c.checked,e.execute("toggleOverlay")});var p=document.getElementById("mainActions"),u=["new","clearCurrent","open","savelocal","save","exportWindow","openHelp","cut","copy","paste","delete","undo","redo","print"];null!=localStorage.getItem("state")&&u.splice(3,0,"openlocal");var P=null,C=function(){P&&P.destroy();var o=Math.floor(250/7),r=document.createElement("div");r.innerHTML=`<table id='exportDlgTable' width=90% align="center">
                  <tr>
                    <td style="padding-top:12px;padding-bottom:12px">
                      File Name
                    </td><td style="padding-top:12px;padding-bottom:12px">
                      <input style="display:table-cell;width:100%;" id='fileName'></input>
                    </td>
                  </tr><tr>
                    <td style="padding-top:12px;padding-bottom:12px">
                      File Format
                    </td><td style="padding-top:12px;padding-bottom:12px">
                      <select id='fileFormat' style="display:table-cell;width:100%;">
                      <option value="png">PNG</option>
                      <option value="jpeg">JPEG</option>
                      <option value="bmp">BMP</option>
                      <option value="svg">SVG</option>
                      </select>
                    </td>
                  </tr><tr>
                    <td style="padding-top:12px;padding-bottom:12px"></td><td style="padding-top:12px;padding-bottom:12px">
                      <button style='float:right;margin-left:12px;height:35px;width:60px' id='exportcBtn'>Cancel</button>
                      <button style='float:right;height:35px;width:60px;background:#4b8cf7;color:#ffffff;border-color:#3079ed;' id='exportBtn'>Export</button>
                    </td>
                  </tr>
                </table>`;var g=document.getElementById("exportWindow").getBoundingClientRect().left,i=document.getElementById("exportWindow").getBoundingClientRect().bottom;P=new mxWindow("Export Dialog",r,g,i,300,void 0,!0,!0,void 0),P.setClosable(!0),P.setMinimizable(!1),P.setVisible(!0),document.getElementById("exportWindow").disabled=!0;var n=document.getElementById("exportcBtn");n.onclick=function(){P.destroy(),document.getElementById("exportWindow").disabled=!1};var a=document.getElementById("exportBtn");a.onclick=function(){e.graph.clearSelection();var o=document.getElementById("fileFormat").value,r=document.getElementById("fileName").value;if(255>r.length&&0<r.length){console.log("filename got"),c.checked=!1,x(e);var g=e.graph,n=g.view.scale,a=g.getGraphBounds(),l=mxUtils.show(e.graph,"new",0,0,a.width,a.height),m=new XMLSerializer().serializeToString(l),d=m.substring(m.indexOf("<svg"),m.indexOf("</svg>")+6);if(document.getElementById("exportWindow").disabled=!1,"svg"==o){var y=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(y),h=document.createElement("a");h.href=s,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),c.checked=!0,x(e),P.hide()}else if("png"==o){var p=document.createElement("canvas");p.width=a.width,p.height=a.height,console.log(p),canvg(p,d,{userCORS:!0,ignoreDimensions:!0});for(var u=p.toDataURL("image/png"),C=atob(u.substring(22)),b=new Uint8Array(C.length),j=0,f=C.length;j<f;++j)b[j]=C.charCodeAt(j);var w=new Blob([b.buffer],{type:"image/png"}),v=URL.createObjectURL(w),h=document.createElement("a");h.href=v,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),c.checked=!0,x(e),P.hide()}else{var p=document.createElement("canvas");p.width=a.width,p.height=a.height,p.style.width=a.width,p.style.height=a.height,p.style.backgroundColor="rgba(255, 255, 255, 1)";var E=p.getContext("2d");if(E.fillStyle="#ffffff",E.fillRect(0,0,p.width,p.height),p.style.opacity="1","jpeg"==o)var G=d.indexOf(">"),d=d.slice(0,G+1)+`<rect width="100%" height="100%" fill="white"/>`+d.slice(G+1);canvg(p,d,{userCORS:!0,ignoreDimensions:!0});for(var N="image/"+o,u=p.toDataURL(N),C=atob(u.substring(("data:"+N+";base64,").length)),b=new Uint8Array(C.length),j=0,f=C.length;j<f;++j)b[j]=C.charCodeAt(j);var w=new Blob([b.buffer],{type:N}),v=URL.createObjectURL(w),h=document.createElement("a");h.href=v,r=r+"."+o,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),c.checked=!0,x(e),P.hide()}}P.isVisible()||P.destroy()}};e.addAction("openlocal",function(){e.graph.getModel().clear();var r=localStorage.getItem("state"),g=mxUtils.parseXml(r),i=new mxCodec(g);i.decode(g.documentElement,e.graph.getModel()),o()}),e.addAction("savelocal",function(){var o=new mxCodec,r=o.encode(e.graph.getModel()),g=mxUtils.getXml(r);localStorage.setItem("state",g)}),e.addAction("new",function(){window.open(window.location.href,"_blank")}),e.addAction("open",function(){var r=document.getElementById("file-input");r.onchange=function(){var g=r.files[0];if(g){var i=new FileReader;i.onload=function(){e.graph.getModel().clear();var r=i.result;r=r.split("syntax").join("mxGraphModel");var g=mxUtils.parseXml(r),n=new mxCodec(g);n.decode(g.documentElement,e.graph.getModel()),o()},i.readAsText(g)}},r.click()}),e.addAction("save",function(){var o=prompt("XML File Name (without extension)","filename");if(null!=o&&255>o.length&&0<o.length&&(-1==o.indexOf(".xml")||o.indexOf(".xml")!=o.length-5)&&(o+=".xml"),o){var r=new mxCodec,g=r.encode(e.graph.getModel()),i=mxUtils.getXml(g);i=i.split("mxGraphModel").join("syntax");var n=new Blob([i],{type:"text/xml;charset=utf-8"}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.download=o,document.body.appendChild(l),l.click(),document.body.removeChild(l)}}),e.addAction("exportWindow",C),e.addAction("openHelp",function(){window.open("../../index.html?noskip=1","_blank")}),e.addAction("clearCurrent",function(){e.graph.getModel().clear()});for(var b,f=0;f<u.length;f++){b=document.createElement("button"),b.id=u[f],b.className="tb_buttons",mxUtils.write(b,mxResources.get(u[f]));var j=function(o){return function(){e.execute(o)}};mxEvent.addListener(b,"click",j(u[f])),"cut"==b.id&&(b.style="margin-left:12px"),p.appendChild(b)}var p=document.getElementById("zoomActions");mxUtils.write(p,"Zoom "),mxUtils.linkAction(p,"In",e,"zoomIn"),mxUtils.write(p,", "),mxUtils.linkAction(p,"Out",e,"zoomOut"),mxUtils.write(p,", "),mxUtils.linkAction(p,"Actual",e,"actualSize"),mxUtils.write(p,", "),mxUtils.linkAction(p,"Fit",e,"fit"),e.addAction("addNewContainer",function(e){var o=prompt("Non-Terminal Name","nonterminal");if(null!=o){var a=0;o+=":";var l=e.graph.getDefaultParent(),m=e.graph.model.getChildCount(l);if(0<m){var d=e.graph.getChildCells(l),s=0;for(a=0;a<d.length;a++)if("swimlane"==d[a].style){var h=d[a].getGeometry();h.y+h.height>=s&&(s=h.y+h.height)}var p=s}else var p=0;var u=m+1,P=e.templates.container,C=e.graph.model.cloneCell(P),b=C.getGeometry();b.y=p,b.height=100,e.graph.model.setGeometry(C,b),C.setAttribute("label",o);var f=e.graph.model.add(l,C,u);e.graph.scrollCellToVisible(f);var w=0,d=e.graph.getChildCells(l),v=g();for(a=0;a<d.length;a++)if("swimlane"==d[a].style){var E=e.graph.model.getChildCells(d[a]);for(z=0;z<E.length;z++){var G=E[z].getValue();if("Roundrect"==G.tagName){for(t=0;t<v.length;t++){var N=E[z].getAttribute("label");0==N.localeCompare(v[t])&&w++}0<w&&(e.graph.model.setStyle(E[z],"Rect"),w=0)}}}P=e.templates.shape;var C=e.graph.model.cloneCell(P);u++;var O=e.graph.model.add(f,C,u),C=e.graph.model.cloneCell(P);u++;var T=e.graph.model.add(f,C,u),B=e.graph.getCellGeometry(f).clone(),A=e.graph.getCellGeometry(O).clone(),I=e.graph.getCellGeometry(T).clone();A.y+=55,I.y+=55,I.x+=.9*B.width,e.graph.model.setGeometry(O,A),e.graph.model.setGeometry(T,I);var R=e.templates.connector,V=e.graph.model.cloneCell(R),k=e.graph.addEdge(V,f,O,T),L=e.graph.insertVertex(f,null,"",b.width/2-25,A.y+25,35,35,"image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0");L.visible=!!c.checked;var S=[],M=null;if(e.graph.addMouseListener({currentState:null,mouseDown:function(o,a){if(null!=this.currentState&&this.dragLeave(a.getEvent(),this.currentState),e.graph.model.isVertex(a.getCell())){var l=a.getCell(),m=e.graph.getCellGeometry(l).clone(),d=e.graph.getCellGeometry(f).clone();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==l.style&&l.parent==f){var y=e.graph.getChildCells(f),s=[];console.log(y);for(var h=0;h<y.length;h++)if("Rect"==y[h].value.tagName||"Roundrect"==y[h].value.tagName){var p=!1,P=!1,C=y[h].geometry.x,b=e.graph.model.getChildren(f);for(z=0;z<b.length;z++){var w=b[z].getValue();if("Connector"==w.tagName){var E=z,G=e.graph.getChildEdges(b[z]);if(null!=G)for(var N=0;N<G.length;N++)if(C+y[h].geometry.width<Math.max(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&C+y[h].geometry.width>Math.min(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&G[N].geometry.targetPoint.y==G[N].geometry.sourcePoint.y&&y[h].geometry.y<G[N].geometry.sourcePoint.y-10&&(P=!0),C<Math.max(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&C>Math.min(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x)&&G[N].geometry.targetPoint.y==G[N].geometry.sourcePoint.y&&y[h].geometry.y<G[N].geometry.sourcePoint.y-10){p=!0;break}}}var B=0;if(y[h].geometry.y>b[1].geometry.y-6&&!1==p){var G=e.graph.getChildEdges(b[2]);if(null!=G)for(var N=0;N<G.length;N++){var A=Math.min(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x),I=Math.max(G[N].geometry.targetPoint.x,G[N].geometry.sourcePoint.x);if(G[N].geometry.targetPoint.y==G[N].geometry.sourcePoint.y&&G[N].geometry.sourcePoint.y-10==y[h].geometry.y&&y[h].geometry.x>A&&y[h].geometry.x+y[h].geometry.width<I){for(var R=0;R<y.length;R++)if(G[N].geometry.sourcePoint.y-10==y[R].geometry.y&&y[R].geometry.x>A&&y[R].geometry.x+y[R].geometry.width<I&&y[h].geometry.x<y[R].geometry.x){B++;break}break}}}if(0==B&&!P&&y[h].geometry.y>b[1].geometry.y-6){var V=e.graph.insertVertex(f,null,"",y[h].geometry.x+y[h].geometry.width+10,y[h].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V)}if(!p){var V=e.graph.insertVertex(f,null,"",y[h].geometry.x-30,y[h].geometry.y,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V),p=!1}}var V=e.graph.insertVertex(f,null,"",T.geometry.x-20,T.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V);var V=e.graph.insertVertex(f,null,"",O.geometry.x+O.geometry.width+10,O.geometry.y-6,20,20,"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0");s.unshift(V);var _=document.createElement("div");_.innerHTML="<table height=100%> <tr> <td> <span id='vertTip'> Select the first (start) point </span> </td></tr><tr><td id='ctrlCluster'> <button style=\"float:bottom\" id='closeBtn' style='align:right'>Cancel</button> </td></tr></table> ",M=new mxWindow("Tip",_,a.getX(),a.getY(),250,void 0,!1,!0),M.setLocation=function(e,o){e=a.getX(),o=a.getY(),mxWindow.prototype.setLocation.apply(this,arguments)},document.getElementById("closeBtn").onclick=function(){for(var o=0;o<s.length;o++)e.graph.model.remove(s[o]);M.destroy(),c.checked=!0,x(e),S.length=0},c.checked=!1,x(e),M.setVisible(!0)}if("image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==l.style&&l.parent==f){4>S.length&&(S.push(m.x+m.width/2),S.push(m.y+10));var y=e.graph.getChildCells(f);if(2==S.length){for(var h=0;h<y.length;h++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==y[h].style&&m.y!=y[h].geometry.y&&e.graph.model.remove(y[h]);document.getElementById("vertTip").innerHTML="Select the second (end) point"}if(4==S.length){for(var h=0;h<y.length;h++)"image;image=images/symbols/event_end.png;editable=0;movable=0;selectable=0;resizable=0"==y[h].style&&e.graph.model.remove(y[h]);var D=O.geometry.y+O.geometry.height/2+30,b=e.graph.model.getChildren(f);for(h=0;h<b.length;h++){var w=b[h].getValue();if("Connector"==w.tagName){var G=e.graph.getChildEdges(b[h]);if(null!=G)for(var N=0;N<G.length;N++)G[N].geometry.sourcePoint.y==G[N].geometry.targetPoint.y&&G[N].geometry.targetPoint.y>=D&&(G[N].geometry.sourcePoint.x>=S[0]&&G[N].geometry.targetPoint.x<=S[2]?D=G[N].geometry.targetPoint.y:G[N].geometry.targetPoint.x>=S[0]&&G[N].geometry.sourcePoint.x<=S[2]&&(D=G[N].geometry.targetPoint.y))}}var H=D+30,W=0;if(S[0]==S[2]&&S[1]==S[3]&&(W=1),S[0]>S[2]){W=2;var X=S[0];S[0]=S[2],S[2]=X}var U=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==W?(U.geometry.setTerminalPoint(new mxPoint(S[0],S[1]),!0),U.geometry.setTerminalPoint(new mxPoint(S[0]+30,H),!1)):1==W?(U.geometry.setTerminalPoint(new mxPoint(S[0],S[1]),!0),U.geometry.setTerminalPoint(new mxPoint(S[0]+30,H),!1)):2==W&&(U.geometry.setTerminalPoint(new mxPoint(S[0]+15,S[1]),!1),U.geometry.points=[new mxPoint(S[0],S[1]+5)],U.geometry.setTerminalPoint(new mxPoint(S[0]+30,H),!0)),U.edge=!0,U=e.graph.addCell(U,k),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[U]));var K=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==W?(K.geometry.setTerminalPoint(new mxPoint(S[2]-30,H),!0),K.geometry.setTerminalPoint(new mxPoint(S[2],S[3]),!1)):1==W?(K.geometry.setTerminalPoint(new mxPoint(S[2]-30,H),!1),K.geometry.setTerminalPoint(new mxPoint(S[2],S[3]),!0)):2==W&&(K.geometry.setTerminalPoint(new mxPoint(S[2]-30,H),!1),K.geometry.points=[new mxPoint(S[2],S[3]+5)],K.geometry.setTerminalPoint(new mxPoint(S[2]-15,S[3]),!0)),K.edge=!0,K=e.graph.addCell(K,k),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[K]));var F=new mxCell("edge",new mxGeometry(0,0,50,50),"curved=0;endArrow=classic;html=1;");0==W?(F.geometry.setTerminalPoint(new mxPoint(S[0]+30,H),!0),F.geometry.setTerminalPoint(new mxPoint(S[2]-30,H),!1)):1==W?(F.geometry.setTerminalPoint(new mxPoint(S[0]+30,H),!0),F.geometry.setTerminalPoint(new mxPoint(S[2]-30,H),!1)):2==W&&(F.geometry.setTerminalPoint(new mxPoint(S[0]+30,H),!1),F.geometry.setTerminalPoint(new mxPoint(S[2]-30,H),!0)),F.edge=!0,F=e.graph.addCell(F,k),e.graph.fireEvent(new mxEventObject("cellsInserted","cells",[F]));var Y=0;for(h=0;h<b.length;h++){var w=b[h].getValue();if("Connector"==w.tagName){var G=e.graph.getChildEdges(b[h]);if(null!=G)for(var N=0;N<G.length;N++)G[N].geometry.sourcePoint.y==G[N].geometry.targetPoint.y&&G[N].geometry.targetPoint.y>=D&&(Y=G[N].geometry.targetPoint.y)}}var Z=L.geometry;Z.y=Y+50,e.graph.model.setGeometry(L,Z);var d=e.graph.getCellGeometry(f).clone();d.height=Z.y+Z.height,e.graph.model.setGeometry(f,d);var q=F.geometry,J=U.geometry,Q=K.geometry;if(0==W)var $={x:J.sourcePoint.x,y:J.sourcePoint.y},ee={x:J.targetPoint.x,y:J.targetPoint.y},te={x:Q.sourcePoint.x,y:Q.sourcePoint.y},oe={x:Q.targetPoint.x,y:Q.targetPoint.y},re={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},ge={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y};else if(1==W)var $={x:J.sourcePoint.x,y:J.sourcePoint.y},ee={x:J.targetPoint.x,y:J.targetPoint.y},te={x:Q.sourcePoint.x,y:Q.sourcePoint.y},oe={x:Q.targetPoint.x,y:Q.targetPoint.y},re={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},ge={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y};else if(2==W)var $={x:J.targetPoint.x,y:J.targetPoint.y},ee={x:J.sourcePoint.x,y:J.sourcePoint.y},te={x:Q.targetPoint.x,y:Q.targetPoint.y},oe={x:Q.sourcePoint.x,y:Q.sourcePoint.y},re={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},ge={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y};if(c.checked)var ie=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var ie=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");ie.cursor="hand",0==W?(ie.offset.x=(oe.x-ee.x-60)/2,console.log("specialcase 0 overlay offset = ",(oe.x-ee.x-60)/2)):2==W&&(ie.offset.x=(oe.x-ee.x-60)/2,console.log("specialcase 2 overlay offset",(oe.x-ee.x-60)/2)),e.graph.addCellOverlay(F,ie),ie.addListener(mxEvent.CLICK,function(){if(0==W)var o={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y},r={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y},i={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},a={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},l={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y},m={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y};else if(2==W)var o={x:U.geometry.targetPoint.x,y:U.geometry.targetPoint.y},r={x:U.geometry.sourcePoint.x,y:U.geometry.sourcePoint.y},i={x:K.geometry.targetPoint.x,y:K.geometry.targetPoint.y},a={x:K.geometry.sourcePoint.x,y:K.geometry.sourcePoint.y},l={x:F.geometry.targetPoint.x,y:F.geometry.targetPoint.y},m={x:F.geometry.sourcePoint.x,y:F.geometry.sourcePoint.y};e.graph.clearSelection();var d=prompt("New Element Name","Enter here"),y=0;if(v=g(),null!=d){for(h=0;h<v.length;h++)0==d.localeCompare(v[h])&&y++;if(0<y)var s=e.templates.rectangle;else var s=e.templates.rounded;var c=e.graph.model.cloneCell(s);c.setAttribute("label",d);var x=c.getGeometry();x.width=Math.round(n(d,"11px arial"))+30,e.graph.model.setGeometry(c,x);var p=[],P=e.graph.model.getChildren(f);console.log(P),console.log(r.x);var C=r.x;for(h=0;h<P.length;h++){var b=P[h].getValue();if("Rect"==b.tagName||"Roundrect"==b.tagName){var w=P[h].getGeometry();if(w.x>=r.x&&w.y==l.y-10&&w.x<=i.x){if(w.x+w.width>=C){C=w.x+w.width;var E=w}p.push(P[h])}}}var G=e.graph.model.add(f,c,u),N=e.graph.getCellGeometry(G).clone();if(N.height=20,N.y=l.y-10,"undefined"!=typeof E){var O=40;for(h=0;h<p.length;h++)O+=p[h].getGeometry().width+40;if(O+=N.width,O>Math.abs(m.x-l.x)){for(h=0;h<P.length;h++){var b=P[h].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&P[h].geometry.x>=m.x){var T=P[h].geometry;T.x+=N.width+40,e.graph.model.setGeometry(P[h],T)}}for(h=0;h<P.length;h++){var B=P[h].getStyle();if("ellipse"==B&&P[h].geometry.x>m.x){var T=P[h].geometry;T.x+=N.width+40,e.graph.model.setGeometry(P[h],T)}var A=m.x,b=P[h].getValue();if("Connector"==b.tagName)for(var I=e.graph.getChildEdges(P[h]),R=0;R<I.length;R++){if(I[R].geometry.sourcePoint.x>=A){var V=I[R].geometry;if(V.sourcePoint.x+=N.width+40,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(I[R].geometry.targetPoint.x>=A){var V=I[R].geometry;if(V.targetPoint.x+=N.width+40,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(null!=I[R].geometry.points&&I[R].geometry.points[0].x>=A){var V=I[R].geometry;V.points[0].x+=N.width+40,e.graph.model.setGeometry(I[R],V)}}}N.x=C+40}else N.x=C+40}else{if(N.width+20>Math.abs(q.targetPoint.x-q.sourcePoint.x)){var P=e.graph.model.getChildren(f);for(h=0;h<P.length;h++){var b=P[h].getValue();if(("Rect"==b.tagName||"Roundrect"==b.tagName)&&P[h].geometry.x>=m.x){var T=P[h].geometry;T.x+=N.width+10,e.graph.model.setGeometry(P[h],T)}}for(h=0;h<P.length;h++){var B=P[h].getStyle();if("ellipse"==B&&P[h].geometry.x>m.x){var T=P[h].geometry;T.x+=N.width+10,e.graph.model.setGeometry(P[h],T)}var A=m.x,b=P[h].getValue();if("Connector"==b.tagName)for(var I=e.graph.getChildEdges(P[h]),R=0;R<I.length;R++){if(I[R].geometry.sourcePoint.x>=A){var V=I[R].geometry;if(V.sourcePoint.x+=N.width+10,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(I[R].geometry.targetPoint.x>=A){var V=I[R].geometry;if(V.targetPoint.x+=N.width+10,e.graph.model.setGeometry(I[R],V),null!=e.graph.getCellOverlays(I[R])){var k=e.graph.getCellOverlays(I[R])[0];k.image=new mxImage("images/add.png",28,28),k.offset.x=Math.abs((V.targetPoint.x-V.sourcePoint.x)/2)}}if(null!=I[R].geometry.points&&I[R].geometry.points[0].x>=A){var V=I[R].geometry;console.log("point before moving",V.points[0].x),V.points[0].x+=N.width+10,e.graph.model.setGeometry(I[R],V),console.log("after moving ",V.points[0].x)}}}}N.x=q.targetPoint.x>q.sourcePoint.x?q.sourcePoint.x+10:q.targetPoint.x+10}e.graph.model.setGeometry(G,N);var L=0,P=e.graph.model.getChildren(f);for(h=0;h<P.length;h++){var S=P[h].getGeometry();S.x>L&&(L=S.x+S.width)}var M=f.getGeometry();for(M.width=L,e.graph.model.setGeometry(f,M),h=0;h<P.length;h++){var B=P[h].getStyle();if("image;image=images/add.png;editable=0;movable=0;selectable=0;resizable=0"==B){var _=P[h].getGeometry();_.x=_.x=Math.round(M.width/2)-_.width/2,e.graph.model.setGeometry(P[h],_);break}}e.graph.refresh()}}),S.length=0,M.destroy(),c.checked=!0,x(e),r()}}}},mouseMove:function(){},mouseUp:function(){},dragEnter:function(){},dragLeave:function(){}}),c.checked)var _=new mxCellOverlay(new mxImage("images/add.png",28,28),"Add New Element");else var _=new mxCellOverlay(new mxImage("images/add.png",0,0),"Add New Element");_.cursor="hand",e.graph.addCellOverlay(k,_),_.addListener(mxEvent.CLICK,function(){e.graph.clearSelection(),v=g();var o=prompt("New Element Name","Enter here"),r=0;if(null!=o){for(a=0;a<v.length;a++)0==o.localeCompare(v[a])&&r++;if(0<r)var i=e.templates.rectangle;else var i=e.templates.rounded;var l=e.graph.model.cloneCell(i);l.setAttribute("label",o);var m=l.getGeometry();m.width=1==o.length?Math.round(n(o,"11px arial"))+10:Math.round(n(o,"11px arial"))+30,e.graph.model.setGeometry(l,m);var d=e.graph.model.getChildren(f),y=0;for(a=0;a<d.length;a++){var s=d[a].getValue();if("Rect"==s.tagName||"Roundrect"==s.tagName){var h=d[a].getGeometry();if(h.x>y&&h.y==I.y-6){y=h.x+h.width}}}for(a=0;a<d.length;a++){var s=d[a].getValue();if("Connector"==s.tagName){for(var c=e.graph.getChildEdges(d[a]),x=0;x<c.length;x++)c[x].geometry.sourcePoint.x>y&&(y=c[x].geometry.sourcePoint.x),c[x].geometry.targetPoint.x>y&&(y=c[x].geometry.targetPoint.x);break}}var p=e.graph.model.add(f,l,u),P=e.graph.getCellGeometry(p).clone();P.height=20,P.y=I.y-6,P.x="undefined"==typeof h?A.x+A.width+40:y+40,e.graph.model.setGeometry(p,P);var C=0,b=e.graph.model.getChildren(f);for(console.log(b),a=0;a<b.length;a++){var w=d[a].geometry;w.x+w.width>C&&(C=w.x+w.width)}var E=f.geometry;E.width=1.15*C,I.x=E.width-10,e.graph.model.setGeometry(T,I),e.graph.model.setGeometry(f,E);var G=e.graph.getCellGeometry(L).clone();G.x=Math.round(E.width/2)-G.width/2,e.graph.model.setGeometry(L,G),e.graph.refresh()}}),_.getBounds=function(e){var o=mxCellOverlay.prototype.getBounds.apply(this,arguments);if(e.view.graph.getModel().isEdge(e.cell)){var r=e.view.getPoint(e,{x:1,y:0,relative:!0});o.x=r.x-o.width/2,o.y=r.y-o.height/2}return o},e.graph.refresh()}})}